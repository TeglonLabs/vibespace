

<html>
	<head>
		<title>Coverage Report</title>
		<meta charset="utf-8" />
        
        <style type="text/css">
        body {
    background-color: #fff;
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
}

table {
    margin-left: 10px;
    border-collapse: collapse;
}

td {
    background-color: #fff;
    padding: 2px;
}

table.overview td {
    padding-right: 20px;
}

td.percent,
td.linecount {
    text-align: right;
}

div.package,
#totalcov {
    color: #fff;
    background-color: #375eab;
    font-size: 16px;
    font-weight: bold;
    padding: 10px;
    border-radius: 5px 5px 5px 5px;
}

div.package,
#totalcov {
    float: right;
    right: 10px;
}

#totalcov {
    top: 10px;
    position: relative;
    background-color: #fff;
    color: #000;
    border: 1px solid #375eab;
    clear: both;
}

#summaryWrapper {
    position: fixed;
    top: 10px;
    float: right;
    right: 10px;

}

span.packageTotal {
    float: right;
    color: #000;
}

#doctitle {
    background-color: #fff;
    font-size: 24px;
    margin-top: 20px;
    margin-left: 10px;
    color: #375eab;
    font-weight: bold;
}

#about {
    margin-left: 18px;
    font-size: 10px;
}

.functitle,
.funcname {
    text-align: center;
    font-size: 20px;
    font-weight: bold;
    color: #375eab;
}

.funcname {
    text-align: left;
    margin-top: 20px;
    margin-left: 10px;
    margin-bottom: 20px;
    padding: 2px 5px 5px;
    background-color: #e0ebf5;
}

table.listing {
    margin-left: 10px;
}

table.listing td {
    padding: 0px;
    font-size: 12px;
    background-color: #eee;
    vertical-align: top;
    padding-left: 10px;
    border-bottom: 1px solid #fff;
}

table.listing td:first-child {
    text-align: right;
    font-weight: bold;
    vertical-align: center;
}

table.listing tr.miss td {
    background-color: #FFBBB8;
}

table.listing tr:last-child td {
    font-weight: normal;
    color: #000;
}

table.listing tr:last-child td:first-child {
    font-weight: bold;
}

.info {
    margin-left: 10px;
}

.info code {}

pre {
    margin: 1px;
}

pre.cmd {
    background-color: #e9e9e9;
    border-radius: 5px 5px 5px 5px;
    padding: 10px;
    margin: 20px;
    line-height: 18px;
    font-size: 14px;
}

a {
    text-decoration: none;
    color: #375eab;
}

a:hover {
    text-decoration: underline;
}

p {
    margin-left: 10px;
}
        </style>
        
	</head>
	<body>
		<div id="doctitle">Coverage Report</div>
        
        <div id="about">Generated on Wed, 19 Mar 2025 06:33:23 PDT with <a href="https://github.com/matm/gocov-html">gocov-html</a></div>
        
        
        <div class="funcname">Report Overview</div>
            <table class="overview">
            
            <tr id="s_pkg_github.com/bmorphism/vibespace-mcp-go/rpcmethods">
                <td><code><a href="#pkg_github.com/bmorphism/vibespace-mcp-go/rpcmethods">github.com/bmorphism/vibespace-mcp-go/rpcmethods</a></code></td>
                <td class="percent"><code>35.3%</code></td>
                <td class="linecount"><code>24/68</code></td>
            </tr>
            
            <tr id="s_pkg_github.com/bmorphism/vibespace-mcp-go/streaming">
                <td><code><a href="#pkg_github.com/bmorphism/vibespace-mcp-go/streaming">github.com/bmorphism/vibespace-mcp-go/streaming</a></code></td>
                <td class="percent"><code>18.9%</code></td>
                <td class="linecount"><code>71/375</code></td>
            </tr>
            
            <tr id="s_pkg_github.com/bmorphism/vibespace-mcp-go/tests">
                <td><code><a href="#pkg_github.com/bmorphism/vibespace-mcp-go/tests">github.com/bmorphism/vibespace-mcp-go/tests</a></code></td>
                <td class="percent"><code>59.8%</code></td>
                <td class="linecount"><code>234/391</code></td>
            </tr>
            
            </table>
            <p>
            This coverage report has been generated with the following command:
            </p>
            <pre class="cmd">gocov test github.com/bmorphism/vibespace-mcp-go/rpcmethods github.com/bmorphism/vibespace-mcp-go/streaming github.com/bmorphism/vibespace-mcp-go/tests | gocov-html </pre>
        </div>
        
        
        <div id="pkg_github.com/bmorphism/vibespace-mcp-go/rpcmethods" class="funcname">
            Package Overview: github.com/bmorphism/vibespace-mcp-go/rpcmethods
            <span class="packageTotal">35.3%</span>
        </div>
        <p>Please select a function to see what's left for testing.</p>

        <table class="overview">
        
            <tr id="s_fn_FindMethod">
                <td>
                    <code><a href="#fn_FindMethod">FindMethod(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/rpcmethods/methods.go</code>
                </td>
                <td class="percent">
                    <code>100.0%</code>
                </td>
                <td class="linecount">
                    <code>7/7</code>
                </td>
            </tr>
        
            <tr id="s_fn_ListMethods">
                <td>
                    <code><a href="#fn_ListMethods">ListMethods(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/rpcmethods/methods.go</code>
                </td>
                <td class="percent">
                    <code>100.0%</code>
                </td>
                <td class="linecount">
                    <code>5/5</code>
                </td>
            </tr>
        
            <tr id="s_fn_GetMethodInfo">
                <td>
                    <code><a href="#fn_GetMethodInfo">GetMethodInfo(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/rpcmethods/methods.go</code>
                </td>
                <td class="percent">
                    <code>100.0%</code>
                </td>
                <td class="linecount">
                    <code>4/4</code>
                </td>
            </tr>
        
            <tr id="s_fn_GetMethodSuggestions">
                <td>
                    <code><a href="#fn_GetMethodSuggestions">GetMethodSuggestions(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/rpcmethods/methods.go</code>
                </td>
                <td class="percent">
                    <code>100.0%</code>
                </td>
                <td class="linecount">
                    <code>4/4</code>
                </td>
            </tr>
        
            <tr id="s_fn_FormatResourceRequest">
                <td>
                    <code><a href="#fn_FormatResourceRequest">FormatResourceRequest(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/rpcmethods/methods.go</code>
                </td>
                <td class="percent">
                    <code>66.7%</code>
                </td>
                <td class="linecount">
                    <code>2/3</code>
                </td>
            </tr>
        
            <tr id="s_fn_FormatToolRequest">
                <td>
                    <code><a href="#fn_FormatToolRequest">FormatToolRequest(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/rpcmethods/methods.go</code>
                </td>
                <td class="percent">
                    <code>66.7%</code>
                </td>
                <td class="linecount">
                    <code>2/3</code>
                </td>
            </tr>
        
            <tr id="s_fn_MCPMethodWrapper.HandleMessage">
                <td>
                    <code><a href="#fn_MCPMethodWrapper.HandleMessage">MCPMethodWrapper.HandleMessage(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/rpcmethods/server_wrapper.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/23</code>
                </td>
            </tr>
        
            <tr id="s_fn_normalizeMethodName">
                <td>
                    <code><a href="#fn_normalizeMethodName">normalizeMethodName(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/rpcmethods/server_wrapper.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/15</code>
                </td>
            </tr>
        
            <tr id="s_fn_IsValidMethod">
                <td>
                    <code><a href="#fn_IsValidMethod">IsValidMethod(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/rpcmethods/methods.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/2</code>
                </td>
            </tr>
        
            <tr id="s_fn_DefaultMethodFormatter">
                <td>
                    <code><a href="#fn_DefaultMethodFormatter">DefaultMethodFormatter(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/rpcmethods/methods.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/1</code>
                </td>
            </tr>
        
            <tr id="s_fn_WrapMCPServer">
                <td>
                    <code><a href="#fn_WrapMCPServer">WrapMCPServer(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/rpcmethods/server_wrapper.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/1</code>
                </td>
            </tr>
        
        </table>

        
        
        <div class="funcname" id="fn_FindMethod">func FindMethod</div>
        <div class="info">
            <a href="#s_fn_FindMethod">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/rpcmethods/methods.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>105</td>
                <td>
                    <code><pre>func FindMethod(partialName string) []string {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>106</td>
                <td>
                    <code><pre>        matches := []string{}</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>107</td>
                <td>
                    <code><pre>        lowercaseName := strings.ToLower(partialName)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>108</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>109</td>
                <td>
                    <code><pre>        for method := range methodRegistry {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>110</td>
                <td>
                    <code><pre>                if strings.Contains(strings.ToLower(method), lowercaseName) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>111</td>
                <td>
                    <code><pre>                        matches = append(matches, method)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>112</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>113</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>114</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>115</td>
                <td>
                    <code><pre>        sort.Strings(matches)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>116</td>
                <td>
                    <code><pre>        return matches</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>117</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_ListMethods">func ListMethods</div>
        <div class="info">
            <a href="#s_fn_ListMethods">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/rpcmethods/methods.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>84</td>
                <td>
                    <code><pre>func ListMethods() []string {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>85</td>
                <td>
                    <code><pre>        methods := make([]string, 0, len(methodRegistry))</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>86</td>
                <td>
                    <code><pre>        for method := range methodRegistry {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>87</td>
                <td>
                    <code><pre>                methods = append(methods, method)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>88</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>89</td>
                <td>
                    <code><pre>        sort.Strings(methods)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>90</td>
                <td>
                    <code><pre>        return methods</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>91</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_GetMethodInfo">func GetMethodInfo</div>
        <div class="info">
            <a href="#s_fn_GetMethodInfo">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/rpcmethods/methods.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>95</td>
                <td>
                    <code><pre>func GetMethodInfo(methodName string) *MethodInfo {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>96</td>
                <td>
                    <code><pre>        info, exists := methodRegistry[methodName]</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>97</td>
                <td>
                    <code><pre>        if !exists {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>98</td>
                <td>
                    <code><pre>                return nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>99</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>100</td>
                <td>
                    <code><pre>        return &amp;info</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>101</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_GetMethodSuggestions">func GetMethodSuggestions</div>
        <div class="info">
            <a href="#s_fn_GetMethodSuggestions">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/rpcmethods/methods.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>160</td>
                <td>
                    <code><pre>func GetMethodSuggestions(invalidMethod string) string {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>161</td>
                <td>
                    <code><pre>        matches := FindMethod(invalidMethod)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>162</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>163</td>
                <td>
                    <code><pre>        if len(matches) == 0 {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>164</td>
                <td>
                    <code><pre>                return fmt.Sprintf(&#34;Method &#39;%s&#39; not found. Try using one of the standard methods: %s, %s&#34;, </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>165</td>
                <td>
                    <code><pre>                        invalidMethod, MethodResourceRead, MethodToolCall)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>166</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>167</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>168</td>
                <td>
                    <code><pre>        return fmt.Sprintf(&#34;Method &#39;%s&#39; not found. Did you mean: %s?&#34;, </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>169</td>
                <td>
                    <code><pre>                invalidMethod, strings.Join(matches, &#34;, &#34;))</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>170</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_FormatResourceRequest">func FormatResourceRequest</div>
        <div class="info">
            <a href="#s_fn_FormatResourceRequest">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/rpcmethods/methods.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>120</td>
                <td>
                    <code><pre>func FormatResourceRequest(uri string, requestID string) map[string]interface{} {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>121</td>
                <td>
                    <code><pre>        if requestID == &#34;&#34; {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>122</td>
                <td>
                    <code><pre>                requestID = &#34;request-id&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>123</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>124</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>125</td>
                <td>
                    <code><pre>        return map[string]interface{}{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>126</td>
                <td>
                    <code><pre>                &#34;jsonrpc&#34;: &#34;2.0&#34;,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>127</td>
                <td>
                    <code><pre>                &#34;id&#34;:      requestID,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>128</td>
                <td>
                    <code><pre>                &#34;method&#34;:  MethodResourceRead,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>129</td>
                <td>
                    <code><pre>                &#34;params&#34;: map[string]interface{}{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>130</td>
                <td>
                    <code><pre>                        &#34;uri&#34;: uri,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>131</td>
                <td>
                    <code><pre>                },</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>132</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>133</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_FormatToolRequest">func FormatToolRequest</div>
        <div class="info">
            <a href="#s_fn_FormatToolRequest">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/rpcmethods/methods.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>136</td>
                <td>
                    <code><pre>func FormatToolRequest(toolName string, arguments map[string]interface{}, requestID string) map[string]interface{} {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>137</td>
                <td>
                    <code><pre>        if requestID == &#34;&#34; {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>138</td>
                <td>
                    <code><pre>                requestID = &#34;request-id&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>139</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>140</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>141</td>
                <td>
                    <code><pre>        return map[string]interface{}{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>142</td>
                <td>
                    <code><pre>                &#34;jsonrpc&#34;: &#34;2.0&#34;,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>143</td>
                <td>
                    <code><pre>                &#34;id&#34;:      requestID,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>144</td>
                <td>
                    <code><pre>                &#34;method&#34;:  MethodToolCall,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>145</td>
                <td>
                    <code><pre>                &#34;params&#34;: map[string]interface{}{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>146</td>
                <td>
                    <code><pre>                        &#34;name&#34;:      toolName,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>147</td>
                <td>
                    <code><pre>                        &#34;arguments&#34;: arguments,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>148</td>
                <td>
                    <code><pre>                },</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>149</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>150</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_MCPMethodWrapper.HandleMessage">func MCPMethodWrapper.HandleMessage</div>
        <div class="info">
            <a href="#s_fn_MCPMethodWrapper.HandleMessage">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/rpcmethods/server_wrapper.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>25</td>
                <td>
                    <code><pre>func (w *MCPMethodWrapper) HandleMessage(ctx context.Context, message json.RawMessage) mcp.JSONRPCMessage {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>26</td>
                <td>
                    <code><pre>        // Parse the message to get the method name</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>27</td>
                <td>
                    <code><pre>        var req map[string]interface{}</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>28</td>
                <td>
                    <code><pre>        if err := json.Unmarshal(message, &amp;req); err != nil {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>29</td>
                <td>
                    <code><pre>                // Pass through to the server if we can&#39;t parse</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>30</td>
                <td>
                    <code><pre>                return w.Server.HandleMessage(ctx, message)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>31</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>32</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>33</td>
                <td>
                    <code><pre>        // Extract method name</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>34</td>
                <td>
                    <code><pre>        methodIface, ok := req[&#34;method&#34;]</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>35</td>
                <td>
                    <code><pre>        if !ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>36</td>
                <td>
                    <code><pre>                // Pass through to the server if no method in request</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>37</td>
                <td>
                    <code><pre>                return w.Server.HandleMessage(ctx, message)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>38</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>39</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>40</td>
                <td>
                    <code><pre>        method, ok := methodIface.(string)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>41</td>
                <td>
                    <code><pre>        if !ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>42</td>
                <td>
                    <code><pre>                // Pass through to the server if method is not a string</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>43</td>
                <td>
                    <code><pre>                return w.Server.HandleMessage(ctx, message)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>44</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>45</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>46</td>
                <td>
                    <code><pre>        // Let&#39;s normalize common method name variants</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>47</td>
                <td>
                    <code><pre>        normalizedMethod := normalizeMethodName(method)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>48</td>
                <td>
                    <code><pre>        if normalizedMethod != method {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>49</td>
                <td>
                    <code><pre>                // If we normalized to a different method, replace it in the request</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>50</td>
                <td>
                    <code><pre>                req[&#34;method&#34;] = normalizedMethod</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>51</td>
                <td>
                    <code><pre>                newMessage, err := json.Marshal(req)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>52</td>
                <td>
                    <code><pre>                if err != nil {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>53</td>
                <td>
                    <code><pre>                        // If we can&#39;t re-marshal, just use the original</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>54</td>
                <td>
                    <code><pre>                        return w.Server.HandleMessage(ctx, message)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>55</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>56</td>
                <td>
                    <code><pre>                message = newMessage</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>57</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>58</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>59</td>
                <td>
                    <code><pre>        // Forward to the server</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>60</td>
                <td>
                    <code><pre>        result := w.Server.HandleMessage(ctx, message)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>61</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>62</td>
                <td>
                    <code><pre>        // Check if it&#39;s an error about method not found</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>63</td>
                <td>
                    <code><pre>        if jsonRPCError, isError := result.(mcp.JSONRPCError); isError {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>64</td>
                <td>
                    <code><pre>                if jsonRPCError.Error.Code == -32601 { // Method not found error code</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>65</td>
                <td>
                    <code><pre>                        // Append suggestion to the error message</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>66</td>
                <td>
                    <code><pre>                        suggestion := GetMethodSuggestions(method)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>67</td>
                <td>
                    <code><pre>                        jsonRPCError.Error.Message = fmt.Sprintf(&#34;%s\n%s&#34;, jsonRPCError.Error.Message, suggestion)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>68</td>
                <td>
                    <code><pre>                        return jsonRPCError</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>69</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>70</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>71</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>72</td>
                <td>
                    <code><pre>        return result</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>73</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_normalizeMethodName">func normalizeMethodName</div>
        <div class="info">
            <a href="#s_fn_normalizeMethodName">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/rpcmethods/server_wrapper.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>76</td>
                <td>
                    <code><pre>func normalizeMethodName(method string) string {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>77</td>
                <td>
                    <code><pre>        // Replace slashes with dots</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>78</td>
                <td>
                    <code><pre>        method = strings.ReplaceAll(method, &#34;/&#34;, &#34;.&#34;)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>79</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>80</td>
                <td>
                    <code><pre>        // Special case handling for resource reads</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>81</td>
                <td>
                    <code><pre>        if strings.Contains(method, &#34;resource&#34;) &amp;&amp; strings.Contains(method, &#34;read&#34;) {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>82</td>
                <td>
                    <code><pre>                return MethodResourceRead</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>83</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>84</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>85</td>
                <td>
                    <code><pre>        // Special case handling for tool calls</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>86</td>
                <td>
                    <code><pre>        if strings.Contains(method, &#34;tool&#34;) &amp;&amp; (strings.Contains(method, &#34;call&#34;) || </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>87</td>
                <td>
                    <code><pre>           strings.Contains(method, &#34;tool.call&#34;) || strings.Contains(method, &#34;tools.call&#34;)) {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>88</td>
                <td>
                    <code><pre>                return MethodToolCall</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>89</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>90</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>91</td>
                <td>
                    <code><pre>        // Handle MCP prefixes</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>92</td>
                <td>
                    <code><pre>        if strings.HasPrefix(method, &#34;mcp.&#34;) {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>93</td>
                <td>
                    <code><pre>                method = method[4:] // Remove mcp. prefix</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>94</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>95</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>96</td>
                <td>
                    <code><pre>        // Check exact matches</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>97</td>
                <td>
                    <code><pre>        if IsValidMethod(method) {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>98</td>
                <td>
                    <code><pre>                return method</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>99</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>100</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>101</td>
                <td>
                    <code><pre>        // Check other common patterns</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>102</td>
                <td>
                    <code><pre>        switch method {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>103</td>
                <td>
                    <code><pre>        case &#34;resource.read&#34;, &#34;resources.read&#34;, &#34;read_resource&#34;, &#34;get_resource&#34;:</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>104</td>
                <td>
                    <code><pre>                return MethodResourceRead</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>105</td>
                <td>
                    <code><pre>        case &#34;tool.call&#34;, &#34;tools.call&#34;, &#34;call_tool&#34;, &#34;execute_tool&#34;:</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>106</td>
                <td>
                    <code><pre>                return MethodToolCall</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>107</td>
                <td>
                    <code><pre>        case &#34;Resources.Read&#34;:</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>108</td>
                <td>
                    <code><pre>                return MethodResourceRead</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>109</td>
                <td>
                    <code><pre>        case &#34;Tools.Call&#34;:</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>110</td>
                <td>
                    <code><pre>                return MethodToolCall</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>111</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>112</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>113</td>
                <td>
                    <code><pre>        // If no matches, return original</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>114</td>
                <td>
                    <code><pre>        return method</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>115</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_IsValidMethod">func IsValidMethod</div>
        <div class="info">
            <a href="#s_fn_IsValidMethod">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/rpcmethods/methods.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>153</td>
                <td>
                    <code><pre>func IsValidMethod(methodName string) bool {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>154</td>
                <td>
                    <code><pre>        _, exists := methodRegistry[methodName]</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>155</td>
                <td>
                    <code><pre>        return exists</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>156</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_DefaultMethodFormatter">func DefaultMethodFormatter</div>
        <div class="info">
            <a href="#s_fn_DefaultMethodFormatter">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/rpcmethods/methods.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>79</td>
                <td>
                    <code><pre>func DefaultMethodFormatter(category, action string) string {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>80</td>
                <td>
                    <code><pre>        return fmt.Sprintf(&#34;method.%s.%s&#34;, category, action)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>81</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_WrapMCPServer">func WrapMCPServer</div>
        <div class="info">
            <a href="#s_fn_WrapMCPServer">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/rpcmethods/server_wrapper.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>19</td>
                <td>
                    <code><pre>func WrapMCPServer(s *server.MCPServer) *MCPMethodWrapper {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>20</td>
                <td>
                    <code><pre>        return &amp;MCPMethodWrapper{Server: s}</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>21</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
         

        <!--    Can be parsed by external script
                PACKAGE:github.com/bmorphism/vibespace-mcp-go/rpcmethods DONE:35.3
        -->
        
        <div id="pkg_github.com/bmorphism/vibespace-mcp-go/streaming" class="funcname">
            Package Overview: github.com/bmorphism/vibespace-mcp-go/streaming
            <span class="packageTotal">18.9%</span>
        </div>
        <p>Please select a function to see what's left for testing.</p>

        <table class="overview">
        
            <tr id="s_fn_NATSClient.IsConnected">
                <td>
                    <code><a href="#fn_NATSClient.IsConnected">NATSClient.IsConnected(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/nats_client.go</code>
                </td>
                <td class="percent">
                    <code>100.0%</code>
                </td>
                <td class="linecount">
                    <code>3/3</code>
                </td>
            </tr>
        
            <tr id="s_fn_NewNATSClientWithStreamID">
                <td>
                    <code><a href="#fn_NewNATSClientWithStreamID">NewNATSClientWithStreamID(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/nats_client.go</code>
                </td>
                <td class="percent">
                    <code>100.0%</code>
                </td>
                <td class="linecount">
                    <code>3/3</code>
                </td>
            </tr>
        
            <tr id="s_fn_StreamingService.IsStreaming">
                <td>
                    <code><a href="#fn_StreamingService.IsStreaming">StreamingService.IsStreaming(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/service.go</code>
                </td>
                <td class="percent">
                    <code>100.0%</code>
                </td>
                <td class="linecount">
                    <code>3/3</code>
                </td>
            </tr>
        
            <tr id="s_fn_NewNATSClient">
                <td>
                    <code><a href="#fn_NewNATSClient">NewNATSClient(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/nats_client.go</code>
                </td>
                <td class="percent">
                    <code>100.0%</code>
                </td>
                <td class="linecount">
                    <code>2/2</code>
                </td>
            </tr>
        
            <tr id="s_fn_NewMomentGenerator">
                <td>
                    <code><a href="#fn_NewMomentGenerator">NewMomentGenerator(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/moment_generator.go</code>
                </td>
                <td class="percent">
                    <code>100.0%</code>
                </td>
                <td class="linecount">
                    <code>1/1</code>
                </td>
            </tr>
        
            <tr id="s_fn_NewStreamingTools">
                <td>
                    <code><a href="#fn_NewStreamingTools">NewStreamingTools(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/tools.go</code>
                </td>
                <td class="percent">
                    <code>100.0%</code>
                </td>
                <td class="linecount">
                    <code>1/1</code>
                </td>
            </tr>
        
            <tr id="s_fn_NewRateLimiter">
                <td>
                    <code><a href="#fn_NewRateLimiter">NewRateLimiter(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/nats_client.go</code>
                </td>
                <td class="percent">
                    <code>100.0%</code>
                </td>
                <td class="linecount">
                    <code>1/1</code>
                </td>
            </tr>
        
            <tr id="s_fn_RateLimiter.TryAcquire">
                <td>
                    <code><a href="#fn_RateLimiter.TryAcquire">RateLimiter.TryAcquire(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/nats_client.go</code>
                </td>
                <td class="percent">
                    <code>92.9%</code>
                </td>
                <td class="linecount">
                    <code>13/14</code>
                </td>
            </tr>
        
            <tr id="s_fn_NewStreamingService">
                <td>
                    <code><a href="#fn_NewStreamingService">NewStreamingService(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/service.go</code>
                </td>
                <td class="percent">
                    <code>80.0%</code>
                </td>
                <td class="linecount">
                    <code>8/10</code>
                </td>
            </tr>
        
            <tr id="s_fn_MomentGenerator.GenerateMoment">
                <td>
                    <code><a href="#fn_MomentGenerator.GenerateMoment">MomentGenerator.GenerateMoment(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/moment_generator.go</code>
                </td>
                <td class="percent">
                    <code>77.8%</code>
                </td>
                <td class="linecount">
                    <code>14/18</code>
                </td>
            </tr>
        
            <tr id="s_fn_NATSClient.GetConnectionStatus">
                <td>
                    <code><a href="#fn_NATSClient.GetConnectionStatus">NATSClient.GetConnectionStatus(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/nats_client.go</code>
                </td>
                <td class="percent">
                    <code>54.5%</code>
                </td>
                <td class="linecount">
                    <code>6/11</code>
                </td>
            </tr>
        
            <tr id="s_fn_StreamingTools.Status">
                <td>
                    <code><a href="#fn_StreamingTools.Status">StreamingTools.Status(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/tools.go</code>
                </td>
                <td class="percent">
                    <code>48.5%</code>
                </td>
                <td class="linecount">
                    <code>16/33</code>
                </td>
            </tr>
        
            <tr id="s_fn_NATSClient.PublishWorldMoment">
                <td>
                    <code><a href="#fn_NATSClient.PublishWorldMoment">NATSClient.PublishWorldMoment(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/nats_client.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/39</code>
                </td>
            </tr>
        
            <tr id="s_fn_StreamingTools.UpdateConfig">
                <td>
                    <code><a href="#fn_StreamingTools.UpdateConfig">StreamingTools.UpdateConfig(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/tools.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/31</code>
                </td>
            </tr>
        
            <tr id="s_fn_StreamingTools.StreamWorld">
                <td>
                    <code><a href="#fn_StreamingTools.StreamWorld">StreamingTools.StreamWorld(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/tools.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/27</code>
                </td>
            </tr>
        
            <tr id="s_fn_StreamingService.StreamSingleWorld">
                <td>
                    <code><a href="#fn_StreamingService.StreamSingleWorld">StreamingService.StreamSingleWorld(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/service.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/22</code>
                </td>
            </tr>
        
            <tr id="s_fn_NATSClient.PublishVibeUpdate">
                <td>
                    <code><a href="#fn_NATSClient.PublishVibeUpdate">NATSClient.PublishVibeUpdate(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/nats_client.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/17</code>
                </td>
            </tr>
        
            <tr id="s_fn_StreamingService.streamMoments">
                <td>
                    <code><a href="#fn_StreamingService.streamMoments">StreamingService.streamMoments(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/service.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/17</code>
                </td>
            </tr>
        
            <tr id="s_fn_NATSClient.Connect">
                <td>
                    <code><a href="#fn_NATSClient.Connect">NATSClient.Connect(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/nats_client.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/16</code>
                </td>
            </tr>
        
            <tr id="s_fn_GetAccessibleContent">
                <td>
                    <code><a href="#fn_GetAccessibleContent">GetAccessibleContent(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/access_control.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/14</code>
                </td>
            </tr>
        
            <tr id="s_fn_CanAccessWorld">
                <td>
                    <code><a href="#fn_CanAccessWorld">CanAccessWorld(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/access_control.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/10</code>
                </td>
            </tr>
        
            <tr id="s_fn_StreamingService.startStreaming">
                <td>
                    <code><a href="#fn_StreamingService.startStreaming">StreamingService.startStreaming(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/service.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/9</code>
                </td>
            </tr>
        
            <tr id="s_fn_MomentGenerator.GenerateAllMoments">
                <td>
                    <code><a href="#fn_MomentGenerator.GenerateAllMoments">MomentGenerator.GenerateAllMoments(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/moment_generator.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/8</code>
                </td>
            </tr>
        
            <tr id="s_fn_StreamingService.Start">
                <td>
                    <code><a href="#fn_StreamingService.Start">StreamingService.Start(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/service.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/7</code>
                </td>
            </tr>
        
            <tr id="s_fn_StreamingService.PublishVibeUpdate">
                <td>
                    <code><a href="#fn_StreamingService.PublishVibeUpdate">StreamingService.PublishVibeUpdate(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/service.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/6</code>
                </td>
            </tr>
        
            <tr id="s_fn_@137:29">
                <td>
                    <code><a href="#fn_@137:29">@137:29(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/nats_client.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/6</code>
                </td>
            </tr>
        
            <tr id="s_fn_StreamingTools.StartStreaming">
                <td>
                    <code><a href="#fn_StreamingTools.StartStreaming">StreamingTools.StartStreaming(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/tools.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/6</code>
                </td>
            </tr>
        
            <tr id="s_fn_StreamingService.Stop">
                <td>
                    <code><a href="#fn_StreamingService.Stop">StreamingService.Stop(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/service.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/5</code>
                </td>
            </tr>
        
            <tr id="s_fn_NATSClient.Close">
                <td>
                    <code><a href="#fn_NATSClient.Close">NATSClient.Close(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/nats_client.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/5</code>
                </td>
            </tr>
        
            <tr id="s_fn_@147:25">
                <td>
                    <code><a href="#fn_@147:25">@147:25(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/nats_client.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/5</code>
                </td>
            </tr>
        
            <tr id="s_fn_@129:21">
                <td>
                    <code><a href="#fn_@129:21">@129:21(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/nats_client.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/4</code>
                </td>
            </tr>
        
            <tr id="s_fn_StreamingService.stopStreaming">
                <td>
                    <code><a href="#fn_StreamingService.stopStreaming">StreamingService.stopStreaming(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/service.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/4</code>
                </td>
            </tr>
        
            <tr id="s_fn_calculateActivity">
                <td>
                    <code><a href="#fn_calculateActivity">calculateActivity(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/moment_generator.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/4</code>
                </td>
            </tr>
        
            <tr id="s_fn_@157:22">
                <td>
                    <code><a href="#fn_@157:22">@157:22(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/nats_client.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/4</code>
                </td>
            </tr>
        
            <tr id="s_fn_StreamingService.StartStreaming">
                <td>
                    <code><a href="#fn_StreamingService.StartStreaming">StreamingService.StartStreaming(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/service.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/3</code>
                </td>
            </tr>
        
            <tr id="s_fn_StreamingService.StopStreaming">
                <td>
                    <code><a href="#fn_StreamingService.StopStreaming">StreamingService.StopStreaming(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/service.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/3</code>
                </td>
            </tr>
        
            <tr id="s_fn_StreamingTools.StopStreaming">
                <td>
                    <code><a href="#fn_StreamingTools.StopStreaming">StreamingTools.StopStreaming(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/tools.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/2</code>
                </td>
            </tr>
        
            <tr id="s_fn_GetStreamingToolMethods">
                <td>
                    <code><a href="#fn_GetStreamingToolMethods">GetStreamingToolMethods(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/streaming/tools.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/1</code>
                </td>
            </tr>
        
        </table>

        
        
        <div class="funcname" id="fn_NATSClient.IsConnected">func NATSClient.IsConnected</div>
        <div class="info">
            <a href="#s_fn_NATSClient.IsConnected">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/nats_client.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>324</td>
                <td>
                    <code><pre>func (c *NATSClient) IsConnected() bool {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>325</td>
                <td>
                    <code><pre>        c.mu.Lock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>326</td>
                <td>
                    <code><pre>        defer c.mu.Unlock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>327</td>
                <td>
                    <code><pre>        return c.connected &amp;&amp; c.conn != nil &amp;&amp; c.conn.IsConnected()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>328</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_NewNATSClientWithStreamID">func NewNATSClientWithStreamID</div>
        <div class="info">
            <a href="#s_fn_NewNATSClientWithStreamID">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/nats_client.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>95</td>
                <td>
                    <code><pre>func NewNATSClientWithStreamID(url string, streamID string) *NATSClient {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>96</td>
                <td>
                    <code><pre>        client := NewNATSClient(url)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>97</td>
                <td>
                    <code><pre>        client.streamID = streamID</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>98</td>
                <td>
                    <code><pre>        return client</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>99</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_StreamingService.IsStreaming">func StreamingService.IsStreaming</div>
        <div class="info">
            <a href="#s_fn_StreamingService.IsStreaming">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/service.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>245</td>
                <td>
                    <code><pre>func (s *StreamingService) IsStreaming() bool {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>246</td>
                <td>
                    <code><pre>        s.mu.Lock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>247</td>
                <td>
                    <code><pre>        defer s.mu.Unlock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>248</td>
                <td>
                    <code><pre>        return s.streamingActive</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>249</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_NewNATSClient">func NewNATSClient</div>
        <div class="info">
            <a href="#s_fn_NewNATSClient">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/nats_client.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>78</td>
                <td>
                    <code><pre>func NewNATSClient(url string) *NATSClient {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>79</td>
                <td>
                    <code><pre>        // Create a rate limiter allowing 100 messages with 10 refills every 1000ms (1 second)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>80</td>
                <td>
                    <code><pre>        // This effectively allows a burst of 100 messages, then 10 messages per second</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>81</td>
                <td>
                    <code><pre>        rateLimiter := NewRateLimiter(100, 10, 1000)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>82</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>83</td>
                <td>
                    <code><pre>        return &amp;NATSClient{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>84</td>
                <td>
                    <code><pre>                url:             url,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>85</td>
                <td>
                    <code><pre>                streamID:        &#34;ies&#34;,         // Default stream ID</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>86</td>
                <td>
                    <code><pre>                connected:       false,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>87</td>
                <td>
                    <code><pre>                reconnectCount:  0,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>88</td>
                <td>
                    <code><pre>                disconnectCount: 0,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>89</td>
                <td>
                    <code><pre>                lastConnectTime: time.Time{}, // Zero time</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>90</td>
                <td>
                    <code><pre>                rateLimiter:     rateLimiter,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>91</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>92</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_NewMomentGenerator">func NewMomentGenerator</div>
        <div class="info">
            <a href="#s_fn_NewMomentGenerator">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/moment_generator.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>16</td>
                <td>
                    <code><pre>func NewMomentGenerator(repo *repository.Repository) *MomentGenerator {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>17</td>
                <td>
                    <code><pre>        return &amp;MomentGenerator{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>18</td>
                <td>
                    <code><pre>                repo: repo,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>19</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>20</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_NewStreamingTools">func NewStreamingTools</div>
        <div class="info">
            <a href="#s_fn_NewStreamingTools">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/tools.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>17</td>
                <td>
                    <code><pre>func NewStreamingTools(service *StreamingService) *StreamingTools {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>18</td>
                <td>
                    <code><pre>        return &amp;StreamingTools{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>19</td>
                <td>
                    <code><pre>                service: service,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>20</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>21</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_NewRateLimiter">func NewRateLimiter</div>
        <div class="info">
            <a href="#s_fn_NewRateLimiter">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/nats_client.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>25</td>
                <td>
                    <code><pre>func NewRateLimiter(maxTokens, refillRate, intervalMs int) *RateLimiter {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>26</td>
                <td>
                    <code><pre>        return &amp;RateLimiter{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>27</td>
                <td>
                    <code><pre>                tokens:     maxTokens,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>28</td>
                <td>
                    <code><pre>                maxTokens:  maxTokens,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>29</td>
                <td>
                    <code><pre>                refillRate: refillRate,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>30</td>
                <td>
                    <code><pre>                lastRefill: time.Now(),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>31</td>
                <td>
                    <code><pre>                intervalMs: intervalMs,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>32</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>33</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_RateLimiter.TryAcquire">func RateLimiter.TryAcquire</div>
        <div class="info">
            <a href="#s_fn_RateLimiter.TryAcquire">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/nats_client.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>36</td>
                <td>
                    <code><pre>func (r *RateLimiter) TryAcquire() bool {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>37</td>
                <td>
                    <code><pre>        r.mu.Lock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>38</td>
                <td>
                    <code><pre>        defer r.mu.Unlock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>39</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>40</td>
                <td>
                    <code><pre>        // Refill tokens if needed</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>41</td>
                <td>
                    <code><pre>        now := time.Now()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>42</td>
                <td>
                    <code><pre>        elapsed := now.Sub(r.lastRefill)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>43</td>
                <td>
                    <code><pre>        if elapsed &gt;= time.Duration(r.intervalMs)*time.Millisecond {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>44</td>
                <td>
                    <code><pre>                // Calculate how many intervals have passed</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>45</td>
                <td>
                    <code><pre>                intervals := int(elapsed.Milliseconds()) / r.intervalMs</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>46</td>
                <td>
                    <code><pre>                // Add tokens based on refill rate and intervals</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>47</td>
                <td>
                    <code><pre>                r.tokens += r.refillRate * intervals</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>48</td>
                <td>
                    <code><pre>                if r.tokens &gt; r.maxTokens {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>49</td>
                <td>
                    <code><pre>                        r.tokens = r.maxTokens</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>50</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>51</td>
                <td>
                    <code><pre>                r.lastRefill = now</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>52</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>53</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>54</td>
                <td>
                    <code><pre>        // Try to acquire a token</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>55</td>
                <td>
                    <code><pre>        if r.tokens &gt; 0 {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>56</td>
                <td>
                    <code><pre>                r.tokens--</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>57</td>
                <td>
                    <code><pre>                return true</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>58</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>59</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>60</td>
                <td>
                    <code><pre>        return false</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>61</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_NewStreamingService">func NewStreamingService</div>
        <div class="info">
            <a href="#s_fn_NewStreamingService">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/service.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>34</td>
                <td>
                    <code><pre>func NewStreamingService(repo *repository.Repository, config *StreamingConfig) *StreamingService {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>35</td>
                <td>
                    <code><pre>        // Set default values if not provided</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>36</td>
                <td>
                    <code><pre>        if config.NATSPort == 0 {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>37</td>
                <td>
                    <code><pre>                config.NATSPort = 4222 // Default NATS port</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>38</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>39</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>40</td>
                <td>
                    <code><pre>        if config.StreamID == &#34;&#34; {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>41</td>
                <td>
                    <code><pre>                config.StreamID = &#34;ies&#34; // Default stream ID</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>42</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>43</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>44</td>
                <td>
                    <code><pre>        // If NATSUrl is not provided, construct it from host and port</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>45</td>
                <td>
                    <code><pre>        if config.NATSUrl == &#34;&#34; &amp;&amp; config.NATSHost != &#34;&#34; {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>46</td>
                <td>
                    <code><pre>                config.NATSUrl = fmt.Sprintf(&#34;nats://%s:%d&#34;, config.NATSHost, config.NATSPort)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>47</td>
                <td>
                    <code><pre>        } else if config.NATSUrl == &#34;&#34; {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>48</td>
                <td>
                    <code><pre>                // Default to nonlocal.info if nothing is provided</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>49</td>
                <td>
                    <code><pre>                config.NATSUrl = fmt.Sprintf(&#34;nats://nonlocal.info:%d&#34;, config.NATSPort)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>50</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>51</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>52</td>
                <td>
                    <code><pre>        // Create NATS client with the configured stream ID</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>53</td>
                <td>
                    <code><pre>        natsClient := NewNATSClientWithStreamID(config.NATSUrl, config.StreamID)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>54</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>55</td>
                <td>
                    <code><pre>        return &amp;StreamingService{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>56</td>
                <td>
                    <code><pre>                natsClient:      natsClient,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>57</td>
                <td>
                    <code><pre>                momentGenerator: NewMomentGenerator(repo),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>58</td>
                <td>
                    <code><pre>                config:          config,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>59</td>
                <td>
                    <code><pre>                repo:            repo,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>60</td>
                <td>
                    <code><pre>                streamingActive: false,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>61</td>
                <td>
                    <code><pre>                stopChan:        make(chan struct{}),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>62</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>63</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_MomentGenerator.GenerateMoment">func MomentGenerator.GenerateMoment</div>
        <div class="info">
            <a href="#s_fn_MomentGenerator.GenerateMoment">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/moment_generator.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>23</td>
                <td>
                    <code><pre>func (g *MomentGenerator) GenerateMoment(worldID string) (*models.WorldMoment, error) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>24</td>
                <td>
                    <code><pre>        // Get the world from the repository</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>25</td>
                <td>
                    <code><pre>        world, err := g.repo.GetWorld(worldID)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>26</td>
                <td>
                    <code><pre>        if err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>27</td>
                <td>
                    <code><pre>                return nil, err</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>28</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>29</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>30</td>
                <td>
                    <code><pre>        // Get the world&#39;s vibe</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>31</td>
                <td>
                    <code><pre>        var vibePtr *models.Vibe</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>32</td>
                <td>
                    <code><pre>        vibe, err := g.repo.GetWorldVibe(worldID)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>33</td>
                <td>
                    <code><pre>        if err == nil {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>34</td>
                <td>
                    <code><pre>                // Make a copy of the vibe</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>35</td>
                <td>
                    <code><pre>                vibeCopy := vibe</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>36</td>
                <td>
                    <code><pre>                vibePtr = &amp;vibeCopy</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>37</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>38</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>39</td>
                <td>
                    <code><pre>        // Create the moment - convert timestamp to milliseconds for consistent handling</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>40</td>
                <td>
                    <code><pre>        now := time.Now().UTC()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>41</td>
                <td>
                    <code><pre>        timestamp := now.UnixNano() / int64(time.Millisecond)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>42</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>43</td>
                <td>
                    <code><pre>        // Calculate activity from world properties</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>44</td>
                <td>
                    <code><pre>        activity := float64(world.Occupancy) / 100.0</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>45</td>
                <td>
                    <code><pre>        if activity &gt; 1.0 {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>46</td>
                <td>
                    <code><pre>                activity = 1.0</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>47</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>48</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>49</td>
                <td>
                    <code><pre>        // Create sharing settings if not present on world</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>50</td>
                <td>
                    <code><pre>        sharing := models.SharingSettings{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>51</td>
                <td>
                    <code><pre>                IsPublic: false,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>52</td>
                <td>
                    <code><pre>                AllowedUsers: []string{},</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>53</td>
                <td>
                    <code><pre>                ContextLevel: models.ContextLevelPartial,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>54</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>55</td>
                <td>
                    <code><pre>        if len(world.Sharing.AllowedUsers) &gt; 0 || world.Sharing.IsPublic {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>56</td>
                <td>
                    <code><pre>                // If world has sharing settings, inherit them</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>57</td>
                <td>
                    <code><pre>                sharing = models.SharingSettings{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>58</td>
                <td>
                    <code><pre>                        IsPublic: world.Sharing.IsPublic,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>59</td>
                <td>
                    <code><pre>                        AllowedUsers: append([]string{}, world.Sharing.AllowedUsers...),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>60</td>
                <td>
                    <code><pre>                        ContextLevel: world.Sharing.ContextLevel,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>61</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>62</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>63</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>64</td>
                <td>
                    <code><pre>        moment := &amp;models.WorldMoment{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>65</td>
                <td>
                    <code><pre>                WorldID:     worldID,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>66</td>
                <td>
                    <code><pre>                Timestamp:   timestamp,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>67</td>
                <td>
                    <code><pre>                VibeID:      world.CurrentVibe,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>68</td>
                <td>
                    <code><pre>                Vibe:        vibePtr,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>69</td>
                <td>
                    <code><pre>                Occupancy:   world.Occupancy,     // Use current world occupancy</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>70</td>
                <td>
                    <code><pre>                Activity:    activity,            // Use calculated activity level</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>71</td>
                <td>
                    <code><pre>                SensorData:  models.SensorData{}, // Initialize empty sensor data</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>72</td>
                <td>
                    <code><pre>                CreatorID:   world.CreatorID,     // Inherit creator from world</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>73</td>
                <td>
                    <code><pre>                Viewers:     []string{},          // Initialize empty viewers list</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>74</td>
                <td>
                    <code><pre>                Sharing:     sharing,             // Use the sharing settings</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>75</td>
                <td>
                    <code><pre>                CustomData:  &#34;&#34;,                  // Initialize empty custom data</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>76</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>77</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>78</td>
                <td>
                    <code><pre>        return moment, nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>79</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_NATSClient.GetConnectionStatus">func NATSClient.GetConnectionStatus</div>
        <div class="info">
            <a href="#s_fn_NATSClient.GetConnectionStatus">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/nats_client.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>344</td>
                <td>
                    <code><pre>func (c *NATSClient) GetConnectionStatus() ConnectionStatus {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>345</td>
                <td>
                    <code><pre>        c.mu.Lock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>346</td>
                <td>
                    <code><pre>        defer c.mu.Unlock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>347</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>348</td>
                <td>
                    <code><pre>        status := ConnectionStatus{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>349</td>
                <td>
                    <code><pre>                IsConnected:     c.connected,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>350</td>
                <td>
                    <code><pre>                URL:             c.url,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>351</td>
                <td>
                    <code><pre>                ReconnectCount:  c.reconnectCount,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>352</td>
                <td>
                    <code><pre>                DisconnectCount: c.disconnectCount,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>353</td>
                <td>
                    <code><pre>                LastConnectTime: c.lastConnectTime,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>354</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>355</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>356</td>
                <td>
                    <code><pre>        if c.lastError != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>357</td>
                <td>
                    <code><pre>                status.LastErrorMessage = c.lastError.Error()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>358</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>359</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>360</td>
                <td>
                    <code><pre>        // Add server-specific information if connected</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>361</td>
                <td>
                    <code><pre>        if c.connected &amp;&amp; c.conn != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>362</td>
                <td>
                    <code><pre>                status.ServerID = c.conn.ConnectedServerId()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>363</td>
                <td>
                    <code><pre>                status.ConnectedURL = c.conn.ConnectedUrl()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>364</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>365</td>
                <td>
                    <code><pre>                // Get RTT (round-trip time) if available</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>366</td>
                <td>
                    <code><pre>                if rtt, err := c.conn.RTT(); err == nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>367</td>
                <td>
                    <code><pre>                        status.RTT = rtt.String()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>368</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>369</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>370</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>371</td>
                <td>
                    <code><pre>        return status</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>372</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_StreamingTools.Status">func StreamingTools.Status</div>
        <div class="info">
            <a href="#s_fn_StreamingTools.Status">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/tools.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>88</td>
                <td>
                    <code><pre>func (t *StreamingTools) Status() (*StatusResponse, error) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>89</td>
                <td>
                    <code><pre>        isStreaming := t.service.IsStreaming()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>90</td>
                <td>
                    <code><pre>        interval := t.service.config.StreamInterval</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>91</td>
                <td>
                    <code><pre>        natsURL := t.service.config.NATSUrl</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>92</td>
                <td>
                    <code><pre>        isConnected := t.service.natsClient.IsConnected()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>93</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>94</td>
                <td>
                    <code><pre>        // Get detailed connection status</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>95</td>
                <td>
                    <code><pre>        connectionStatus := t.service.natsClient.GetConnectionStatus()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>96</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>97</td>
                <td>
                    <code><pre>        statusMsg := &#34;Streaming inactive&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>98</td>
                <td>
                    <code><pre>        if isStreaming {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>99</td>
                <td>
                    <code><pre>                statusMsg = fmt.Sprintf(&#34;Streaming active with interval %v&#34;, interval)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>100</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>101</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>102</td>
                <td>
                    <code><pre>        response := &amp;StatusResponse{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>103</td>
                <td>
                    <code><pre>                IsStreaming:      isStreaming,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>104</td>
                <td>
                    <code><pre>                StreamInterval:   interval.String(),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>105</td>
                <td>
                    <code><pre>                NATSUrl:          natsURL,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>106</td>
                <td>
                    <code><pre>                Message:          statusMsg,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>107</td>
                <td>
                    <code><pre>                ConnectionStatus: connectionStatus,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>108</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>109</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>110</td>
                <td>
                    <code><pre>        // Set UI indicator values</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>111</td>
                <td>
                    <code><pre>        response.UIIndicators.StreamActive = isStreaming</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>112</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>113</td>
                <td>
                    <code><pre>        // Set stream indicator based on status</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>114</td>
                <td>
                    <code><pre>        if isStreaming {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>115</td>
                <td>
                    <code><pre>                response.UIIndicators.StreamIndicator = &#34;ACTIVE&#34;</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>116</td>
                <td>
                    <code><pre>                response.UIIndicators.StatusColor = &#34;#4CAF50&#34; // Green</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>117</td>
                <td>
                    <code><pre>        } else if isConnected {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>118</td>
                <td>
                    <code><pre>                response.UIIndicators.StreamIndicator = &#34;READY&#34;</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>119</td>
                <td>
                    <code><pre>                response.UIIndicators.StatusColor = &#34;#2196F3&#34; // Blue</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>120</td>
                <td>
                    <code><pre>        } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>121</td>
                <td>
                    <code><pre>                response.UIIndicators.StreamIndicator = &#34;OFFLINE&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>122</td>
                <td>
                    <code><pre>                response.UIIndicators.StatusColor = &#34;#F44336&#34; // Red</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>123</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>124</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>125</td>
                <td>
                    <code><pre>        // Set connection quality</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>126</td>
                <td>
                    <code><pre>        if isConnected {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>127</td>
                <td>
                    <code><pre>                // Use RTT (round-trip time) to determine connection quality if available</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>128</td>
                <td>
                    <code><pre>                if connectionStatus.RTT != &#34;&#34; {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>129</td>
                <td>
                    <code><pre>                        rttStr := connectionStatus.RTT</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>130</td>
                <td>
                    <code><pre>                        if strings.Contains(rttStr, &#34;s&#34;) || // microseconds</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>131</td>
                <td>
                    <code><pre>                           (strings.Contains(rttStr, &#34;ms&#34;) &amp;&amp; strings.HasPrefix(rttStr, &#34;0.&#34;)) { // &lt; 1ms</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>132</td>
                <td>
                    <code><pre>                                response.UIIndicators.ConnectionQuality = &#34;EXCELLENT&#34;</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>133</td>
                <td>
                    <code><pre>                        } else if strings.Contains(rttStr, &#34;ms&#34;) &amp;&amp; </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>134</td>
                <td>
                    <code><pre>                                 !strings.HasPrefix(rttStr, &#34;0.&#34;) &amp;&amp; </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>135</td>
                <td>
                    <code><pre>                                         !strings.HasPrefix(rttStr, &#34;1&#34;) { // 1-9ms</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>136</td>
                <td>
                    <code><pre>                                response.UIIndicators.ConnectionQuality = &#34;GOOD&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>137</td>
                <td>
                    <code><pre>                        } else { // 10ms+ or seconds</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>138</td>
                <td>
                    <code><pre>                                response.UIIndicators.ConnectionQuality = &#34;FAIR&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>139</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>140</td>
                <td>
                    <code><pre>                } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>141</td>
                <td>
                    <code><pre>                        // Fall back to URL-based determination</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>142</td>
                <td>
                    <code><pre>                        if strings.Contains(natsURL, &#34;nonlocal.info&#34;) {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>143</td>
                <td>
                    <code><pre>                                response.UIIndicators.ConnectionQuality = &#34;REMOTE&#34;</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>144</td>
                <td>
                    <code><pre>                        } else if strings.Contains(natsURL, &#34;localhost&#34;) {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>145</td>
                <td>
                    <code><pre>                                response.UIIndicators.ConnectionQuality = &#34;LOCAL&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>146</td>
                <td>
                    <code><pre>                        } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>147</td>
                <td>
                    <code><pre>                                response.UIIndicators.ConnectionQuality = &#34;CUSTOM&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>148</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>149</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>150</td>
                <td>
                    <code><pre>        } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>151</td>
                <td>
                    <code><pre>                response.UIIndicators.ConnectionQuality = &#34;DISCONNECTED&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>152</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>153</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>154</td>
                <td>
                    <code><pre>        return response, nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>155</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_NATSClient.PublishWorldMoment">func NATSClient.PublishWorldMoment</div>
        <div class="info">
            <a href="#s_fn_NATSClient.PublishWorldMoment">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/nats_client.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>190</td>
                <td>
                    <code><pre>func (c *NATSClient) PublishWorldMoment(moment *models.WorldMoment, userID string) error {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>191</td>
                <td>
                    <code><pre>        // Check connection first without holding the main lock</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>192</td>
                <td>
                    <code><pre>        if !c.IsConnected() {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>193</td>
                <td>
                    <code><pre>                return fmt.Errorf(&#34;not connected to NATS server&#34;)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>194</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>195</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>196</td>
                <td>
                    <code><pre>        // Apply rate limiting</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>197</td>
                <td>
                    <code><pre>        if !c.rateLimiter.TryAcquire() {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>198</td>
                <td>
                    <code><pre>                return fmt.Errorf(&#34;rate limit exceeded, too many messages being published&#34;)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>199</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>200</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>201</td>
                <td>
                    <code><pre>        c.mu.Lock()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>202</td>
                <td>
                    <code><pre>        defer c.mu.Unlock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>203</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>204</td>
                <td>
                    <code><pre>        // Double-check connection after acquiring lock</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>205</td>
                <td>
                    <code><pre>        if !c.connected || c.conn == nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>206</td>
                <td>
                    <code><pre>                return fmt.Errorf(&#34;not connected to NATS server&#34;)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>207</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>208</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>209</td>
                <td>
                    <code><pre>        // If creator is not set, use the provided userID</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>210</td>
                <td>
                    <code><pre>        if moment.CreatorID == &#34;&#34; {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>211</td>
                <td>
                    <code><pre>                moment.CreatorID = userID</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>212</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>213</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>214</td>
                <td>
                    <code><pre>        // Create subjects for different access patterns (including stream ID)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>215</td>
                <td>
                    <code><pre>        // 1. World-specific subject</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>216</td>
                <td>
                    <code><pre>        worldSubject := fmt.Sprintf(&#34;%s.world.moment.%s&#34;, c.streamID, moment.WorldID)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>217</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>218</td>
                <td>
                    <code><pre>        // 2. Creator-specific subject for their worlds</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>219</td>
                <td>
                    <code><pre>        creatorSubject := fmt.Sprintf(&#34;%s.world.moment.%s.user.%s&#34;, c.streamID, moment.WorldID, moment.CreatorID)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>220</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>221</td>
                <td>
                    <code><pre>        // Serialize the moment to JSON</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>222</td>
                <td>
                    <code><pre>        data, err := json.Marshal(moment)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>223</td>
                <td>
                    <code><pre>        if err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>224</td>
                <td>
                    <code><pre>                return fmt.Errorf(&#34;failed to marshal world moment: %w&#34;, err)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>225</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>226</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>227</td>
                <td>
                    <code><pre>        // Publish to world subject if public</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>228</td>
                <td>
                    <code><pre>        if moment.Sharing.IsPublic {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>229</td>
                <td>
                    <code><pre>                if err := c.conn.Publish(worldSubject, data); err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>230</td>
                <td>
                    <code><pre>                        return fmt.Errorf(&#34;failed to publish to world subject: %w&#34;, err)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>231</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>232</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>233</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>234</td>
                <td>
                    <code><pre>        // Always publish to creator&#39;s subject</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>235</td>
                <td>
                    <code><pre>        if err := c.conn.Publish(creatorSubject, data); err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>236</td>
                <td>
                    <code><pre>                return fmt.Errorf(&#34;failed to publish to creator subject: %w&#34;, err)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>237</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>238</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>239</td>
                <td>
                    <code><pre>        // Count of successful publications</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>240</td>
                <td>
                    <code><pre>        publishCount := 1 // Creator subject always published</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>241</td>
                <td>
                    <code><pre>        if moment.Sharing.IsPublic {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>242</td>
                <td>
                    <code><pre>                publishCount++ // Public subject if applicable</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>243</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>244</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>245</td>
                <td>
                    <code><pre>        // Publish to each allowed user&#39;s subject with filtered content</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>246</td>
                <td>
                    <code><pre>        for _, allowedUserID := range moment.Sharing.AllowedUsers {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>247</td>
                <td>
                    <code><pre>                // Skip if it&#39;s the creator (already published)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>248</td>
                <td>
                    <code><pre>                if allowedUserID == moment.CreatorID {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>249</td>
                <td>
                    <code><pre>                        continue</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>250</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>251</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>252</td>
                <td>
                    <code><pre>                // Get filtered content for this user</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>253</td>
                <td>
                    <code><pre>                filteredMoment := GetAccessibleContent(allowedUserID, moment)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>254</td>
                <td>
                    <code><pre>                if filteredMoment == nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>255</td>
                <td>
                    <code><pre>                        continue</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>256</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>257</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>258</td>
                <td>
                    <code><pre>                // Create user-specific subject</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>259</td>
                <td>
                    <code><pre>                userSubject := fmt.Sprintf(&#34;%s.world.moment.%s.user.%s&#34;, c.streamID, moment.WorldID, allowedUserID)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>260</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>261</td>
                <td>
                    <code><pre>                // Serialize the filtered moment</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>262</td>
                <td>
                    <code><pre>                filteredData, err := json.Marshal(filteredMoment)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>263</td>
                <td>
                    <code><pre>                if err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>264</td>
                <td>
                    <code><pre>                        fmt.Printf(&#34;Warning: Failed to marshal filtered moment for user %s: %v\n&#34;, allowedUserID, err)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>265</td>
                <td>
                    <code><pre>                        continue</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>266</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>267</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>268</td>
                <td>
                    <code><pre>                // Publish to user-specific subject</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>269</td>
                <td>
                    <code><pre>                if err := c.conn.Publish(userSubject, filteredData); err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>270</td>
                <td>
                    <code><pre>                        fmt.Printf(&#34;Warning: Failed to publish to user subject %s: %v\n&#34;, userSubject, err)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>271</td>
                <td>
                    <code><pre>                } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>272</td>
                <td>
                    <code><pre>                        publishCount++</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>273</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>274</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>275</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>276</td>
                <td>
                    <code><pre>        // Log successful publishing</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>277</td>
                <td>
                    <code><pre>        fmt.Printf(&#34;Published world moment for %s to %d subjects\n&#34;, moment.WorldID, publishCount)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>278</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>279</td>
                <td>
                    <code><pre>        return nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>280</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_StreamingTools.UpdateConfig">func StreamingTools.UpdateConfig</div>
        <div class="info">
            <a href="#s_fn_StreamingTools.UpdateConfig">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/tools.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>280</td>
                <td>
                    <code><pre>func (t *StreamingTools) UpdateConfig(req *UpdateConfigRequest) (*UpdateConfigResponse, error) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>281</td>
                <td>
                    <code><pre>        // Track if we need to create a new client</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>282</td>
                <td>
                    <code><pre>        needNewClient := false</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>283</td>
                <td>
                    <code><pre>        wasStreaming := t.service.IsStreaming()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>284</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>285</td>
                <td>
                    <code><pre>        // Update NATS URL if provided directly</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>286</td>
                <td>
                    <code><pre>        if req.NATSUrl != &#34;&#34; {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>287</td>
                <td>
                    <code><pre>                t.service.config.NATSUrl = req.NATSUrl</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>288</td>
                <td>
                    <code><pre>                needNewClient = true</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>289</td>
                <td>
                    <code><pre>        } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>290</td>
                <td>
                    <code><pre>                // Update host and port independently if provided</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>291</td>
                <td>
                    <code><pre>                if req.NATSHost != &#34;&#34; {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>292</td>
                <td>
                    <code><pre>                        t.service.config.NATSHost = req.NATSHost</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>293</td>
                <td>
                    <code><pre>                        needNewClient = true</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>294</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>295</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>296</td>
                <td>
                    <code><pre>                if req.NATSPort &gt; 0 {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>297</td>
                <td>
                    <code><pre>                        t.service.config.NATSPort = req.NATSPort</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>298</td>
                <td>
                    <code><pre>                        needNewClient = true</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>299</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>300</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>301</td>
                <td>
                    <code><pre>                // Reconstruct the URL if host or port changed</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>302</td>
                <td>
                    <code><pre>                if needNewClient {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>303</td>
                <td>
                    <code><pre>                        t.service.config.NATSUrl = fmt.Sprintf(&#34;nats://%s:%d&#34;, </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>304</td>
                <td>
                    <code><pre>                                t.service.config.NATSHost, </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>305</td>
                <td>
                    <code><pre>                                t.service.config.NATSPort)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>306</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>307</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>308</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>309</td>
                <td>
                    <code><pre>        // Update stream ID if provided</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>310</td>
                <td>
                    <code><pre>        streamIDChanged := false</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>311</td>
                <td>
                    <code><pre>        if req.StreamID != &#34;&#34; {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>312</td>
                <td>
                    <code><pre>                t.service.config.StreamID = req.StreamID</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>313</td>
                <td>
                    <code><pre>                streamIDChanged = true</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>314</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>315</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>316</td>
                <td>
                    <code><pre>        // If we need to create a new client due to URL or stream ID changes</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>317</td>
                <td>
                    <code><pre>        if needNewClient || streamIDChanged {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>318</td>
                <td>
                    <code><pre>                // Stop streaming if active</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>319</td>
                <td>
                    <code><pre>                if wasStreaming {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>320</td>
                <td>
                    <code><pre>                        t.service.StopStreaming()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>321</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>322</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>323</td>
                <td>
                    <code><pre>                // Close the old connection</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>324</td>
                <td>
                    <code><pre>                t.service.natsClient.Close()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>325</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>326</td>
                <td>
                    <code><pre>                // Create a new client with the updated configuration</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>327</td>
                <td>
                    <code><pre>                t.service.natsClient = NewNATSClientWithStreamID(</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>328</td>
                <td>
                    <code><pre>                        t.service.config.NATSUrl, </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>329</td>
                <td>
                    <code><pre>                        t.service.config.StreamID)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>330</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>331</td>
                <td>
                    <code><pre>                // Reconnect and resume streaming if needed</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>332</td>
                <td>
                    <code><pre>                err := t.service.natsClient.Connect()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>333</td>
                <td>
                    <code><pre>                if err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>334</td>
                <td>
                    <code><pre>                        return &amp;UpdateConfigResponse{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>335</td>
                <td>
                    <code><pre>                                Success: false,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>336</td>
                <td>
                    <code><pre>                                Message: fmt.Sprintf(&#34;Failed to connect to new NATS server: %v&#34;, err),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>337</td>
                <td>
                    <code><pre>                        }, nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>338</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>339</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>340</td>
                <td>
                    <code><pre>                if wasStreaming {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>341</td>
                <td>
                    <code><pre>                        if err := t.service.StartStreaming(); err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>342</td>
                <td>
                    <code><pre>                                return &amp;UpdateConfigResponse{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>343</td>
                <td>
                    <code><pre>                                        Success: false,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>344</td>
                <td>
                    <code><pre>                                        Message: fmt.Sprintf(&#34;Failed to restart streaming: %v&#34;, err),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>345</td>
                <td>
                    <code><pre>                                }, nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>346</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>347</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>348</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>349</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>350</td>
                <td>
                    <code><pre>        // Update stream interval if provided</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>351</td>
                <td>
                    <code><pre>        if req.StreamInterval &gt; 0 {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>352</td>
                <td>
                    <code><pre>                t.service.config.StreamInterval = time.Duration(req.StreamInterval) * time.Millisecond</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>353</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>354</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>355</td>
                <td>
                    <code><pre>        return &amp;UpdateConfigResponse{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>356</td>
                <td>
                    <code><pre>                Success: true,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>357</td>
                <td>
                    <code><pre>                Message: fmt.Sprintf(&#34;Configuration updated successfully (NATS: %s, Stream ID: %s)&#34;,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>358</td>
                <td>
                    <code><pre>                        t.service.config.NATSUrl,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>359</td>
                <td>
                    <code><pre>                        t.service.config.StreamID),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>360</td>
                <td>
                    <code><pre>        }, nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>361</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_StreamingTools.StreamWorld">func StreamingTools.StreamWorld</div>
        <div class="info">
            <a href="#s_fn_StreamingTools.StreamWorld">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/tools.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>178</td>
                <td>
                    <code><pre>func (t *StreamingTools) StreamWorld(req *StreamWorldRequest) (*StreamWorldResponse, error) {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>179</td>
                <td>
                    <code><pre>        if req.WorldID == &#34;&#34; {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>180</td>
                <td>
                    <code><pre>                return &amp;StreamWorldResponse{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>181</td>
                <td>
                    <code><pre>                        Success: false,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>182</td>
                <td>
                    <code><pre>                        Message: &#34;World ID is required&#34;,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>183</td>
                <td>
                    <code><pre>                }, nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>184</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>185</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>186</td>
                <td>
                    <code><pre>        // Require user ID for attribution and access control</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>187</td>
                <td>
                    <code><pre>        if req.UserID == &#34;&#34; {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>188</td>
                <td>
                    <code><pre>                return &amp;StreamWorldResponse{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>189</td>
                <td>
                    <code><pre>                        Success: false,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>190</td>
                <td>
                    <code><pre>                        Message: &#34;User ID is required&#34;,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>191</td>
                <td>
                    <code><pre>                }, nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>192</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>193</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>194</td>
                <td>
                    <code><pre>        // Apply sharing settings if provided</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>195</td>
                <td>
                    <code><pre>        if req.Sharing != nil {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>196</td>
                <td>
                    <code><pre>                // Get the world first to apply sharing settings</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>197</td>
                <td>
                    <code><pre>                moment, err := t.service.momentGenerator.GenerateMoment(req.WorldID)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>198</td>
                <td>
                    <code><pre>                if err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>199</td>
                <td>
                    <code><pre>                        return &amp;StreamWorldResponse{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>200</td>
                <td>
                    <code><pre>                                Success: false,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>201</td>
                <td>
                    <code><pre>                                Message: fmt.Sprintf(&#34;Failed to generate world moment: %v&#34;, err),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>202</td>
                <td>
                    <code><pre>                        }, nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>203</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>204</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>205</td>
                <td>
                    <code><pre>                // Apply the sharing settings</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>206</td>
                <td>
                    <code><pre>                moment.CreatorID = req.UserID</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>207</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>208</td>
                <td>
                    <code><pre>                // Create sharing settings from request</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>209</td>
                <td>
                    <code><pre>                moment.Sharing = models.SharingSettings{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>210</td>
                <td>
                    <code><pre>                        IsPublic: req.Sharing.IsPublic,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>211</td>
                <td>
                    <code><pre>                        AllowedUsers: req.Sharing.AllowedUsers,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>212</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>213</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>214</td>
                <td>
                    <code><pre>                // Apply context level if provided</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>215</td>
                <td>
                    <code><pre>                if req.Sharing.ContextLevel != &#34;&#34; {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>216</td>
                <td>
                    <code><pre>                        moment.Sharing.ContextLevel = models.ContextLevel(req.Sharing.ContextLevel)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>217</td>
                <td>
                    <code><pre>                } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>218</td>
                <td>
                    <code><pre>                        // Default to partial if not specified</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>219</td>
                <td>
                    <code><pre>                        moment.Sharing.ContextLevel = models.ContextLevelPartial</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>220</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>221</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>222</td>
                <td>
                    <code><pre>                // Add the requesting user to viewers</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>223</td>
                <td>
                    <code><pre>                userExists := false</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>224</td>
                <td>
                    <code><pre>                for _, viewer := range moment.Viewers {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>225</td>
                <td>
                    <code><pre>                        if viewer == req.UserID {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>226</td>
                <td>
                    <code><pre>                                userExists = true</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>227</td>
                <td>
                    <code><pre>                                break</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>228</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>229</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>230</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>231</td>
                <td>
                    <code><pre>                if !userExists {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>232</td>
                <td>
                    <code><pre>                        moment.Viewers = append(moment.Viewers, req.UserID)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>233</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>234</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>235</td>
                <td>
                    <code><pre>                // Publish directly with user&#39;s sharing preferences</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>236</td>
                <td>
                    <code><pre>                if err := t.service.natsClient.PublishWorldMoment(moment, req.UserID); err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>237</td>
                <td>
                    <code><pre>                        return &amp;StreamWorldResponse{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>238</td>
                <td>
                    <code><pre>                                Success: false,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>239</td>
                <td>
                    <code><pre>                                Message: fmt.Sprintf(&#34;Failed to publish world moment: %v&#34;, err),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>240</td>
                <td>
                    <code><pre>                        }, nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>241</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>242</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>243</td>
                <td>
                    <code><pre>                return &amp;StreamWorldResponse{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>244</td>
                <td>
                    <code><pre>                        Success: true,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>245</td>
                <td>
                    <code><pre>                        Message: fmt.Sprintf(&#34;Streamed moment for world %s by user %s with custom sharing settings&#34;, req.WorldID, req.UserID),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>246</td>
                <td>
                    <code><pre>                }, nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>247</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>248</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>249</td>
                <td>
                    <code><pre>        // If no custom sharing, use default service method</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>250</td>
                <td>
                    <code><pre>        err := t.service.StreamSingleWorld(req.WorldID, req.UserID)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>251</td>
                <td>
                    <code><pre>        if err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>252</td>
                <td>
                    <code><pre>                return &amp;StreamWorldResponse{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>253</td>
                <td>
                    <code><pre>                        Success: false,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>254</td>
                <td>
                    <code><pre>                        Message: fmt.Sprintf(&#34;Failed to stream world moment: %v&#34;, err),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>255</td>
                <td>
                    <code><pre>                }, nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>256</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>257</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>258</td>
                <td>
                    <code><pre>        return &amp;StreamWorldResponse{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>259</td>
                <td>
                    <code><pre>                Success: true,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>260</td>
                <td>
                    <code><pre>                Message: fmt.Sprintf(&#34;Streamed moment for world %s by user %s&#34;, req.WorldID, req.UserID),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>261</td>
                <td>
                    <code><pre>        }, nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>262</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_StreamingService.StreamSingleWorld">func StreamingService.StreamSingleWorld</div>
        <div class="info">
            <a href="#s_fn_StreamingService.StreamSingleWorld">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/service.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>192</td>
                <td>
                    <code><pre>func (s *StreamingService) StreamSingleWorld(worldID string, userID string) error {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>193</td>
                <td>
                    <code><pre>        s.mu.Lock()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>194</td>
                <td>
                    <code><pre>        defer s.mu.Unlock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>195</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>196</td>
                <td>
                    <code><pre>        // Make sure we&#39;re connected to NATS</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>197</td>
                <td>
                    <code><pre>        if !s.natsClient.IsConnected() {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>198</td>
                <td>
                    <code><pre>                if err := s.natsClient.Connect(); err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>199</td>
                <td>
                    <code><pre>                        return fmt.Errorf(&#34;failed to connect to NATS: %w&#34;, err)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>200</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>201</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>202</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>203</td>
                <td>
                    <code><pre>        // Generate a moment for the world</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>204</td>
                <td>
                    <code><pre>        moment, err := s.momentGenerator.GenerateMoment(worldID)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>205</td>
                <td>
                    <code><pre>        if err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>206</td>
                <td>
                    <code><pre>                return fmt.Errorf(&#34;failed to generate moment: %w&#34;, err)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>207</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>208</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>209</td>
                <td>
                    <code><pre>        // Set creator ID if not already set</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>210</td>
                <td>
                    <code><pre>        if moment.CreatorID == &#34;&#34; {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>211</td>
                <td>
                    <code><pre>                moment.CreatorID = userID</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>212</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>213</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>214</td>
                <td>
                    <code><pre>        // If world already has viewers, add this user if not already there</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>215</td>
                <td>
                    <code><pre>        userExists := false</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>216</td>
                <td>
                    <code><pre>        for _, viewer := range moment.Viewers {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>217</td>
                <td>
                    <code><pre>                if viewer == userID {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>218</td>
                <td>
                    <code><pre>                        userExists = true</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>219</td>
                <td>
                    <code><pre>                        break</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>220</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>221</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>222</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>223</td>
                <td>
                    <code><pre>        if !userExists {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>224</td>
                <td>
                    <code><pre>                moment.Viewers = append(moment.Viewers, userID)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>225</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>226</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>227</td>
                <td>
                    <code><pre>        // Set default sharing settings if needed (completely empty or only default values)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>228</td>
                <td>
                    <code><pre>        if !moment.Sharing.IsPublic &amp;&amp; len(moment.Sharing.AllowedUsers) == 0 &amp;&amp; moment.Sharing.ContextLevel == &#34;&#34; {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>229</td>
                <td>
                    <code><pre>                moment.Sharing = models.SharingSettings{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>230</td>
                <td>
                    <code><pre>                        IsPublic:     false,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>231</td>
                <td>
                    <code><pre>                        AllowedUsers: []string{},</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>232</td>
                <td>
                    <code><pre>                        ContextLevel: models.ContextLevelPartial,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>233</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>234</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>235</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>236</td>
                <td>
                    <code><pre>        // Publish the moment with user information</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>237</td>
                <td>
                    <code><pre>        if err := s.natsClient.PublishWorldMoment(moment, userID); err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>238</td>
                <td>
                    <code><pre>                return fmt.Errorf(&#34;failed to publish moment: %w&#34;, err)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>239</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>240</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>241</td>
                <td>
                    <code><pre>        return nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>242</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_NATSClient.PublishVibeUpdate">func NATSClient.PublishVibeUpdate</div>
        <div class="info">
            <a href="#s_fn_NATSClient.PublishVibeUpdate">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/nats_client.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>283</td>
                <td>
                    <code><pre>func (c *NATSClient) PublishVibeUpdate(worldID string, vibe *models.Vibe) error {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>284</td>
                <td>
                    <code><pre>        // Check connection first without holding the main lock</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>285</td>
                <td>
                    <code><pre>        if !c.IsConnected() {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>286</td>
                <td>
                    <code><pre>                return fmt.Errorf(&#34;not connected to NATS server&#34;)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>287</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>288</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>289</td>
                <td>
                    <code><pre>        // Apply rate limiting</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>290</td>
                <td>
                    <code><pre>        if !c.rateLimiter.TryAcquire() {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>291</td>
                <td>
                    <code><pre>                return fmt.Errorf(&#34;rate limit exceeded, too many messages being published&#34;)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>292</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>293</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>294</td>
                <td>
                    <code><pre>        c.mu.Lock()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>295</td>
                <td>
                    <code><pre>        defer c.mu.Unlock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>296</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>297</td>
                <td>
                    <code><pre>        // Double-check connection after acquiring lock</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>298</td>
                <td>
                    <code><pre>        if !c.connected || c.conn == nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>299</td>
                <td>
                    <code><pre>                return fmt.Errorf(&#34;not connected to NATS server&#34;)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>300</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>301</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>302</td>
                <td>
                    <code><pre>        // Create the subject for vibe updates with stream ID</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>303</td>
                <td>
                    <code><pre>        subject := fmt.Sprintf(&#34;%s.world.vibe.%s&#34;, c.streamID, worldID)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>304</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>305</td>
                <td>
                    <code><pre>        // Serialize the vibe to JSON</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>306</td>
                <td>
                    <code><pre>        data, err := json.Marshal(vibe)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>307</td>
                <td>
                    <code><pre>        if err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>308</td>
                <td>
                    <code><pre>                return fmt.Errorf(&#34;failed to marshal vibe: %w&#34;, err)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>309</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>310</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>311</td>
                <td>
                    <code><pre>        // Publish the data</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>312</td>
                <td>
                    <code><pre>        err = c.conn.Publish(subject, data)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>313</td>
                <td>
                    <code><pre>        if err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>314</td>
                <td>
                    <code><pre>                return fmt.Errorf(&#34;failed to publish vibe update: %w&#34;, err)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>315</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>316</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>317</td>
                <td>
                    <code><pre>        // Log successful publishing</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>318</td>
                <td>
                    <code><pre>        fmt.Printf(&#34;Published vibe update for world %s\n&#34;, worldID)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>319</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>320</td>
                <td>
                    <code><pre>        return nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>321</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_StreamingService.streamMoments">func StreamingService.streamMoments</div>
        <div class="info">
            <a href="#s_fn_StreamingService.streamMoments">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/service.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>146</td>
                <td>
                    <code><pre>func (s *StreamingService) streamMoments() {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>147</td>
                <td>
                    <code><pre>        ticker := time.NewTicker(s.config.StreamInterval)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>148</td>
                <td>
                    <code><pre>        defer ticker.Stop()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>149</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>150</td>
                <td>
                    <code><pre>        for {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>151</td>
                <td>
                    <code><pre>                select {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>152</td>
                <td>
                    <code><pre>                case &lt;-ticker.C:</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>153</td>
                <td>
                    <code><pre>                        // Generate and publish moments for all worlds</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>154</td>
                <td>
                    <code><pre>                        moments, err := s.momentGenerator.GenerateAllMoments()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>155</td>
                <td>
                    <code><pre>                        if err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>156</td>
                <td>
                    <code><pre>                                fmt.Printf(&#34;Error generating moments: %v\n&#34;, err)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>157</td>
                <td>
                    <code><pre>                                continue</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>158</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>159</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>160</td>
                <td>
                    <code><pre>                        // Publish each moment</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>161</td>
                <td>
                    <code><pre>                        for _, moment := range moments {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>162</td>
                <td>
                    <code><pre>                                // For automatic streaming, we use the &#34;system&#34; as the creator ID</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>163</td>
                <td>
                    <code><pre>                                // if it&#39;s not already set</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>164</td>
                <td>
                    <code><pre>                                creatorID := moment.CreatorID</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>165</td>
                <td>
                    <code><pre>                                if creatorID == &#34;&#34; {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>166</td>
                <td>
                    <code><pre>                                        creatorID = &#34;system&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>167</td>
                <td>
                    <code><pre>                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>168</td>
                <td>
                    <code><pre>                                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>169</td>
                <td>
                    <code><pre>                                // Set default sharing settings for automated moments if needed</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>170</td>
                <td>
                    <code><pre>                                if !moment.Sharing.IsPublic &amp;&amp; len(moment.Sharing.AllowedUsers) == 0 &amp;&amp; moment.Sharing.ContextLevel == &#34;&#34; {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>171</td>
                <td>
                    <code><pre>                                        // By default, system-generated moments are public with partial context</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>172</td>
                <td>
                    <code><pre>                                        moment.Sharing = models.SharingSettings{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>173</td>
                <td>
                    <code><pre>                                                IsPublic:     true,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>174</td>
                <td>
                    <code><pre>                                                AllowedUsers: []string{},</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>175</td>
                <td>
                    <code><pre>                                                ContextLevel: models.ContextLevelPartial,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>176</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>177</td>
                <td>
                    <code><pre>                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>178</td>
                <td>
                    <code><pre>                                </pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>179</td>
                <td>
                    <code><pre>                                if err := s.natsClient.PublishWorldMoment(moment, creatorID); err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>180</td>
                <td>
                    <code><pre>                                        fmt.Printf(&#34;Error publishing moment for world %s: %v\n&#34;, moment.WorldID, err)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>181</td>
                <td>
                    <code><pre>                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>182</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>183</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>184</td>
                <td>
                    <code><pre>                case &lt;-s.stopChan:</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>185</td>
                <td>
                    <code><pre>                        // Streaming has been stopped</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>186</td>
                <td>
                    <code><pre>                        return</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>187</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>188</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>189</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_NATSClient.Connect">func NATSClient.Connect</div>
        <div class="info">
            <a href="#s_fn_NATSClient.Connect">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/nats_client.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>102</td>
                <td>
                    <code><pre>func (c *NATSClient) Connect() error {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>103</td>
                <td>
                    <code><pre>        c.mu.Lock()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>104</td>
                <td>
                    <code><pre>        defer c.mu.Unlock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>105</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>106</td>
                <td>
                    <code><pre>        if c.connected &amp;&amp; c.conn != nil &amp;&amp; c.conn.IsConnected() {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>107</td>
                <td>
                    <code><pre>                return nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>108</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>109</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>110</td>
                <td>
                    <code><pre>        // Clear any previous connection</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>111</td>
                <td>
                    <code><pre>        if c.conn != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>112</td>
                <td>
                    <code><pre>                c.conn.Close()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>113</td>
                <td>
                    <code><pre>                c.conn = nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>114</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>115</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>116</td>
                <td>
                    <code><pre>        // Track connection metrics</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>117</td>
                <td>
                    <code><pre>        c.lastConnectTime = time.Now()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>118</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>119</td>
                <td>
                    <code><pre>        var err error</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>120</td>
                <td>
                    <code><pre>        c.conn, err = nats.Connect(c.url,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>121</td>
                <td>
                    <code><pre>                nats.RetryOnFailedConnect(true),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>122</td>
                <td>
                    <code><pre>                nats.MaxReconnects(-1),            // Unlimited reconnect attempts</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>123</td>
                <td>
                    <code><pre>                nats.ReconnectWait(2*time.Second), // Wait 2 seconds between reconnect attempts</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>124</td>
                <td>
                    <code><pre>                nats.Timeout(5*time.Second),       // Connect timeout</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>125</td>
                <td>
                    <code><pre>                nats.PingInterval(20*time.Second), // How often to ping the server to check connection</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>126</td>
                <td>
                    <code><pre>                nats.MaxPingsOutstanding(5),       // Max number of pings in flight</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>127</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>128</td>
                <td>
                    <code><pre>                // Error handlers</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>129</td>
                <td>
                    <code><pre>                nats.ErrorHandler(func(nc *nats.Conn, sub *nats.Subscription, err error) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>130</td>
                <td>
                    <code><pre>                        c.mu.Lock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>131</td>
                <td>
                    <code><pre>                        c.lastError = err</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>132</td>
                <td>
                    <code><pre>                        c.mu.Unlock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>133</td>
                <td>
                    <code><pre>                        fmt.Printf(&#34;NATS error: %v\n&#34;, err)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>134</td>
                <td>
                    <code><pre>                }),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>135</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>136</td>
                <td>
                    <code><pre>                // Disconnect handler</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>137</td>
                <td>
                    <code><pre>                nats.DisconnectErrHandler(func(nc *nats.Conn, err error) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>138</td>
                <td>
                    <code><pre>                        c.mu.Lock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>139</td>
                <td>
                    <code><pre>                        c.connected = false</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>140</td>
                <td>
                    <code><pre>                        c.disconnectCount++</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>141</td>
                <td>
                    <code><pre>                        c.lastError = err</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>142</td>
                <td>
                    <code><pre>                        c.mu.Unlock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>143</td>
                <td>
                    <code><pre>                        fmt.Printf(&#34;NATS disconnected: %v\n&#34;, err)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>144</td>
                <td>
                    <code><pre>                }),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>145</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>146</td>
                <td>
                    <code><pre>                // Reconnect handler</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>147</td>
                <td>
                    <code><pre>                nats.ReconnectHandler(func(nc *nats.Conn) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>148</td>
                <td>
                    <code><pre>                        c.mu.Lock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>149</td>
                <td>
                    <code><pre>                        c.connected = true</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>150</td>
                <td>
                    <code><pre>                        c.reconnectCount++</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>151</td>
                <td>
                    <code><pre>                        c.mu.Unlock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>152</td>
                <td>
                    <code><pre>                        fmt.Printf(&#34;NATS reconnected to %s (reconnect count: %d)\n&#34;, </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>153</td>
                <td>
                    <code><pre>                                nc.ConnectedUrl(), c.reconnectCount)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>154</td>
                <td>
                    <code><pre>                }),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>155</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>156</td>
                <td>
                    <code><pre>                // Closed handler</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>157</td>
                <td>
                    <code><pre>                nats.ClosedHandler(func(nc *nats.Conn) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>158</td>
                <td>
                    <code><pre>                        c.mu.Lock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>159</td>
                <td>
                    <code><pre>                        c.connected = false</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>160</td>
                <td>
                    <code><pre>                        c.mu.Unlock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>161</td>
                <td>
                    <code><pre>                        fmt.Printf(&#34;NATS connection closed\n&#34;)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>162</td>
                <td>
                    <code><pre>                }),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>163</td>
                <td>
                    <code><pre>        )</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>164</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>165</td>
                <td>
                    <code><pre>        if err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>166</td>
                <td>
                    <code><pre>                c.lastError = err</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>167</td>
                <td>
                    <code><pre>                return fmt.Errorf(&#34;failed to connect to NATS: %w&#34;, err)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>168</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>169</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>170</td>
                <td>
                    <code><pre>        c.connected = true</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>171</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>172</td>
                <td>
                    <code><pre>        // Log successful connection</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>173</td>
                <td>
                    <code><pre>        fmt.Printf(&#34;Successfully connected to NATS server at %s\n&#34;, c.url)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>174</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>175</td>
                <td>
                    <code><pre>        return nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>176</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_GetAccessibleContent">func GetAccessibleContent</div>
        <div class="info">
            <a href="#s_fn_GetAccessibleContent">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/access_control.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>38</td>
                <td>
                    <code><pre>func GetAccessibleContent(userID string, moment *models.WorldMoment) *models.WorldMoment {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>39</td>
                <td>
                    <code><pre>        // If the user doesn&#39;t have access, return nil</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>40</td>
                <td>
                    <code><pre>        if !CanAccessWorld(userID, moment) {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>41</td>
                <td>
                    <code><pre>                return nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>42</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>43</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>44</td>
                <td>
                    <code><pre>        // If the user is the creator, they get full access</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>45</td>
                <td>
                    <code><pre>        if userID == moment.CreatorID {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>46</td>
                <td>
                    <code><pre>                return moment</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>47</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>48</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>49</td>
                <td>
                    <code><pre>        // Make a copy to avoid modifying the original</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>50</td>
                <td>
                    <code><pre>        result := *moment</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>51</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>52</td>
                <td>
                    <code><pre>        // Apply context level filtering</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>53</td>
                <td>
                    <code><pre>        switch moment.Sharing.ContextLevel {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>54</td>
                <td>
                    <code><pre>        case models.ContextLevelNone:</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>55</td>
                <td>
                    <code><pre>                // Provide minimal information - just ID, type and public metadata</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>56</td>
                <td>
                    <code><pre>                result.CustomData = &#34;&#34;</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>57</td>
                <td>
                    <code><pre>                result.SensorData = models.SensorData{}</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>58</td>
                <td>
                    <code><pre>                if result.Vibe != nil {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>59</td>
                <td>
                    <code><pre>                        // Remove vibe details but keep basic info</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>60</td>
                <td>
                    <code><pre>                        vibe := *result.Vibe</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>61</td>
                <td>
                    <code><pre>                        vibe.SensorData = models.SensorData{}</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>62</td>
                <td>
                    <code><pre>                        result.Vibe = &amp;vibe</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>63</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>64</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>65</td>
                <td>
                    <code><pre>        case models.ContextLevelPartial:</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>66</td>
                <td>
                    <code><pre>                // Provide moderate information but not custom/sensitive data</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>67</td>
                <td>
                    <code><pre>                result.CustomData = &#34;&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>68</td>
                <td>
                    <code><pre>                // Keep sensor data and vibe information</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>69</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>70</td>
                <td>
                    <code><pre>        case models.ContextLevelFull:</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>71</td>
                <td>
                    <code><pre>                // Provide all information - no changes needed</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>72</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>73</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>74</td>
                <td>
                    <code><pre>        return &amp;result</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>75</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_CanAccessWorld">func CanAccessWorld</div>
        <div class="info">
            <a href="#s_fn_CanAccessWorld">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/access_control.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>8</td>
                <td>
                    <code><pre>func CanAccessWorld(userID string, moment *models.WorldMoment) bool {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>9</td>
                <td>
                    <code><pre>        // If the moment has no sharing settings defined (empty allowed users and not public), default to private</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>10</td>
                <td>
                    <code><pre>        if !moment.Sharing.IsPublic &amp;&amp; len(moment.Sharing.AllowedUsers) == 0 {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>11</td>
                <td>
                    <code><pre>                // Only the creator can access</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>12</td>
                <td>
                    <code><pre>                return userID == moment.CreatorID</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>13</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>14</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>15</td>
                <td>
                    <code><pre>        // If the world is public, anyone can access</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>16</td>
                <td>
                    <code><pre>        if moment.Sharing.IsPublic {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>17</td>
                <td>
                    <code><pre>                return true</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>18</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>19</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>20</td>
                <td>
                    <code><pre>        // If the user is the creator, they always have access</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>21</td>
                <td>
                    <code><pre>        if userID == moment.CreatorID {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>22</td>
                <td>
                    <code><pre>                return true</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>23</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>24</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>25</td>
                <td>
                    <code><pre>        // Check if the user is in the allowed users list</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>26</td>
                <td>
                    <code><pre>        for _, allowedUser := range moment.Sharing.AllowedUsers {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>27</td>
                <td>
                    <code><pre>                if userID == allowedUser {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>28</td>
                <td>
                    <code><pre>                        return true</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>29</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>30</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>31</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>32</td>
                <td>
                    <code><pre>        // Default to no access</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>33</td>
                <td>
                    <code><pre>        return false</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>34</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_StreamingService.startStreaming">func StreamingService.startStreaming</div>
        <div class="info">
            <a href="#s_fn_StreamingService.startStreaming">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/service.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>105</td>
                <td>
                    <code><pre>func (s *StreamingService) startStreaming() error {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>106</td>
                <td>
                    <code><pre>        if s.streamingActive {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>107</td>
                <td>
                    <code><pre>                return nil // Already streaming</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>108</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>109</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>110</td>
                <td>
                    <code><pre>        // Make sure we&#39;re connected to NATS</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>111</td>
                <td>
                    <code><pre>        if !s.natsClient.IsConnected() {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>112</td>
                <td>
                    <code><pre>                if err := s.natsClient.Connect(); err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>113</td>
                <td>
                    <code><pre>                        return fmt.Errorf(&#34;failed to connect to NATS: %w&#34;, err)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>114</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>115</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>116</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>117</td>
                <td>
                    <code><pre>        // Reset the stop channel</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>118</td>
                <td>
                    <code><pre>        s.stopChan = make(chan struct{})</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>119</td>
                <td>
                    <code><pre>        s.streamingActive = true</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>120</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>121</td>
                <td>
                    <code><pre>        // Start the streaming goroutine</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>122</td>
                <td>
                    <code><pre>        go s.streamMoments()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>123</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>124</td>
                <td>
                    <code><pre>        return nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>125</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_MomentGenerator.GenerateAllMoments">func MomentGenerator.GenerateAllMoments</div>
        <div class="info">
            <a href="#s_fn_MomentGenerator.GenerateAllMoments">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/moment_generator.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>82</td>
                <td>
                    <code><pre>func (g *MomentGenerator) GenerateAllMoments() ([]*models.WorldMoment, error) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>83</td>
                <td>
                    <code><pre>        // Get all worlds</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>84</td>
                <td>
                    <code><pre>        worlds := g.repo.GetAllWorlds()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>85</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>86</td>
                <td>
                    <code><pre>        moments := make([]*models.WorldMoment, 0, len(worlds))</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>87</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>88</td>
                <td>
                    <code><pre>        // Generate a moment for each world</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>89</td>
                <td>
                    <code><pre>        for _, world := range worlds {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>90</td>
                <td>
                    <code><pre>                moment, err := g.GenerateMoment(world.ID)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>91</td>
                <td>
                    <code><pre>                if err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>92</td>
                <td>
                    <code><pre>                        continue // Skip worlds with errors</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>93</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>94</td>
                <td>
                    <code><pre>                moments = append(moments, moment)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>95</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>96</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>97</td>
                <td>
                    <code><pre>        return moments, nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>98</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_StreamingService.Start">func StreamingService.Start</div>
        <div class="info">
            <a href="#s_fn_StreamingService.Start">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/service.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>66</td>
                <td>
                    <code><pre>func (s *StreamingService) Start() error {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>67</td>
                <td>
                    <code><pre>        s.mu.Lock()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>68</td>
                <td>
                    <code><pre>        defer s.mu.Unlock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>69</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>70</td>
                <td>
                    <code><pre>        // Connect to NATS</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>71</td>
                <td>
                    <code><pre>        if err := s.natsClient.Connect(); err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>72</td>
                <td>
                    <code><pre>                return fmt.Errorf(&#34;failed to connect to NATS: %w&#34;, err)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>73</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>74</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>75</td>
                <td>
                    <code><pre>        // Start streaming if autoStart is enabled</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>76</td>
                <td>
                    <code><pre>        if s.config.AutoStart {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>77</td>
                <td>
                    <code><pre>                return s.startStreaming()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>78</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>79</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>80</td>
                <td>
                    <code><pre>        return nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>81</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_StreamingService.PublishVibeUpdate">func StreamingService.PublishVibeUpdate</div>
        <div class="info">
            <a href="#s_fn_StreamingService.PublishVibeUpdate">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/service.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>252</td>
                <td>
                    <code><pre>func (s *StreamingService) PublishVibeUpdate(worldID string, vibe *models.Vibe) error {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>253</td>
                <td>
                    <code><pre>        s.mu.Lock()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>254</td>
                <td>
                    <code><pre>        defer s.mu.Unlock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>255</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>256</td>
                <td>
                    <code><pre>        // Make sure we&#39;re connected to NATS</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>257</td>
                <td>
                    <code><pre>        if !s.natsClient.IsConnected() {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>258</td>
                <td>
                    <code><pre>                if err := s.natsClient.Connect(); err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>259</td>
                <td>
                    <code><pre>                        return fmt.Errorf(&#34;failed to connect to NATS: %w&#34;, err)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>260</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>261</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>262</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>263</td>
                <td>
                    <code><pre>        // Publish the vibe update</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>264</td>
                <td>
                    <code><pre>        return s.natsClient.PublishVibeUpdate(worldID, vibe)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>265</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_@137:29">func @137:29</div>
        <div class="info">
            <a href="#s_fn_@137:29">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/nats_client.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>137</td>
                <td>
                    <code><pre>func(nc *nats.Conn, err error) {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>138</td>
                <td>
                    <code><pre>                        c.mu.Lock()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>139</td>
                <td>
                    <code><pre>                        c.connected = false</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>140</td>
                <td>
                    <code><pre>                        c.disconnectCount++</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>141</td>
                <td>
                    <code><pre>                        c.lastError = err</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>142</td>
                <td>
                    <code><pre>                        c.mu.Unlock()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>143</td>
                <td>
                    <code><pre>                        fmt.Printf(&#34;NATS disconnected: %v\n&#34;, err)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>144</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_StreamingTools.StartStreaming">func StreamingTools.StartStreaming</div>
        <div class="info">
            <a href="#s_fn_StreamingTools.StartStreaming">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/tools.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>35</td>
                <td>
                    <code><pre>func (t *StreamingTools) StartStreaming(req *StartStreamingRequest) (*StartStreamingResponse, error) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>36</td>
                <td>
                    <code><pre>        // If interval is provided, update the stream interval</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>37</td>
                <td>
                    <code><pre>        if req.Interval &gt; 0 {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>38</td>
                <td>
                    <code><pre>                t.service.config.StreamInterval = time.Duration(req.Interval) * time.Millisecond</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>39</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>40</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>41</td>
                <td>
                    <code><pre>        // Start streaming</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>42</td>
                <td>
                    <code><pre>        err := t.service.StartStreaming()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>43</td>
                <td>
                    <code><pre>        if err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>44</td>
                <td>
                    <code><pre>                return &amp;StartStreamingResponse{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>45</td>
                <td>
                    <code><pre>                        Success: false,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>46</td>
                <td>
                    <code><pre>                        Message: fmt.Sprintf(&#34;Failed to start streaming: %v&#34;, err),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>47</td>
                <td>
                    <code><pre>                }, nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>48</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>49</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>50</td>
                <td>
                    <code><pre>        return &amp;StartStreamingResponse{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>51</td>
                <td>
                    <code><pre>                Success: true,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>52</td>
                <td>
                    <code><pre>                Message: fmt.Sprintf(&#34;Streaming started with interval %v&#34;, t.service.config.StreamInterval),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>53</td>
                <td>
                    <code><pre>        }, nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>54</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_StreamingService.Stop">func StreamingService.Stop</div>
        <div class="info">
            <a href="#s_fn_StreamingService.Stop">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/service.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>84</td>
                <td>
                    <code><pre>func (s *StreamingService) Stop() {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>85</td>
                <td>
                    <code><pre>        s.mu.Lock()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>86</td>
                <td>
                    <code><pre>        defer s.mu.Unlock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>87</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>88</td>
                <td>
                    <code><pre>        // Stop streaming if active</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>89</td>
                <td>
                    <code><pre>        if s.streamingActive {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>90</td>
                <td>
                    <code><pre>                s.stopStreaming()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>91</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>92</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>93</td>
                <td>
                    <code><pre>        // Close NATS connection</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>94</td>
                <td>
                    <code><pre>        s.natsClient.Close()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>95</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_NATSClient.Close">func NATSClient.Close</div>
        <div class="info">
            <a href="#s_fn_NATSClient.Close">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/nats_client.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>179</td>
                <td>
                    <code><pre>func (c *NATSClient) Close() {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>180</td>
                <td>
                    <code><pre>        c.mu.Lock()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>181</td>
                <td>
                    <code><pre>        defer c.mu.Unlock()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>182</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>183</td>
                <td>
                    <code><pre>        if c.conn != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>184</td>
                <td>
                    <code><pre>                c.conn.Close()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>185</td>
                <td>
                    <code><pre>                c.connected = false</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>186</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>187</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_@147:25">func @147:25</div>
        <div class="info">
            <a href="#s_fn_@147:25">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/nats_client.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>147</td>
                <td>
                    <code><pre>func(nc *nats.Conn) {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>148</td>
                <td>
                    <code><pre>                        c.mu.Lock()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>149</td>
                <td>
                    <code><pre>                        c.connected = true</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>150</td>
                <td>
                    <code><pre>                        c.reconnectCount++</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>151</td>
                <td>
                    <code><pre>                        c.mu.Unlock()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>152</td>
                <td>
                    <code><pre>                        fmt.Printf(&#34;NATS reconnected to %s (reconnect count: %d)\n&#34;, </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>153</td>
                <td>
                    <code><pre>                                nc.ConnectedUrl(), c.reconnectCount)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>154</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_@129:21">func @129:21</div>
        <div class="info">
            <a href="#s_fn_@129:21">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/nats_client.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>129</td>
                <td>
                    <code><pre>func(nc *nats.Conn, sub *nats.Subscription, err error) {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>130</td>
                <td>
                    <code><pre>                        c.mu.Lock()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>131</td>
                <td>
                    <code><pre>                        c.lastError = err</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>132</td>
                <td>
                    <code><pre>                        c.mu.Unlock()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>133</td>
                <td>
                    <code><pre>                        fmt.Printf(&#34;NATS error: %v\n&#34;, err)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>134</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_StreamingService.stopStreaming">func StreamingService.stopStreaming</div>
        <div class="info">
            <a href="#s_fn_StreamingService.stopStreaming">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/service.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>135</td>
                <td>
                    <code><pre>func (s *StreamingService) stopStreaming() {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>136</td>
                <td>
                    <code><pre>        if !s.streamingActive {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>137</td>
                <td>
                    <code><pre>                return // Not streaming</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>138</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>139</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>140</td>
                <td>
                    <code><pre>        // Signal the streaming goroutine to stop</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>141</td>
                <td>
                    <code><pre>        close(s.stopChan)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>142</td>
                <td>
                    <code><pre>        s.streamingActive = false</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>143</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_calculateActivity">func calculateActivity</div>
        <div class="info">
            <a href="#s_fn_calculateActivity">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/moment_generator.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>101</td>
                <td>
                    <code><pre>func calculateActivity(world models.World) float64 {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>102</td>
                <td>
                    <code><pre>        // This is a placeholder implementation</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>103</td>
                <td>
                    <code><pre>        // In a real system, this would consider recent changes, occupancy trends, sensor data, etc.</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>104</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>105</td>
                <td>
                    <code><pre>        // For now, just use occupancy as a simple activity metric</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>106</td>
                <td>
                    <code><pre>        activity := float64(world.Occupancy) / 100.0</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>107</td>
                <td>
                    <code><pre>        if activity &gt; 1.0 {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>108</td>
                <td>
                    <code><pre>                activity = 1.0</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>109</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>110</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>111</td>
                <td>
                    <code><pre>        return activity</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>112</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_@157:22">func @157:22</div>
        <div class="info">
            <a href="#s_fn_@157:22">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/nats_client.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>157</td>
                <td>
                    <code><pre>func(nc *nats.Conn) {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>158</td>
                <td>
                    <code><pre>                        c.mu.Lock()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>159</td>
                <td>
                    <code><pre>                        c.connected = false</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>160</td>
                <td>
                    <code><pre>                        c.mu.Unlock()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>161</td>
                <td>
                    <code><pre>                        fmt.Printf(&#34;NATS connection closed\n&#34;)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>162</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_StreamingService.StartStreaming">func StreamingService.StartStreaming</div>
        <div class="info">
            <a href="#s_fn_StreamingService.StartStreaming">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/service.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>98</td>
                <td>
                    <code><pre>func (s *StreamingService) StartStreaming() error {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>99</td>
                <td>
                    <code><pre>        s.mu.Lock()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>100</td>
                <td>
                    <code><pre>        defer s.mu.Unlock()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>101</td>
                <td>
                    <code><pre>        return s.startStreaming()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>102</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_StreamingService.StopStreaming">func StreamingService.StopStreaming</div>
        <div class="info">
            <a href="#s_fn_StreamingService.StopStreaming">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/service.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>128</td>
                <td>
                    <code><pre>func (s *StreamingService) StopStreaming() {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>129</td>
                <td>
                    <code><pre>        s.mu.Lock()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>130</td>
                <td>
                    <code><pre>        defer s.mu.Unlock()</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>131</td>
                <td>
                    <code><pre>        s.stopStreaming()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>132</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_StreamingTools.StopStreaming">func StreamingTools.StopStreaming</div>
        <div class="info">
            <a href="#s_fn_StreamingTools.StopStreaming">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/tools.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>63</td>
                <td>
                    <code><pre>func (t *StreamingTools) StopStreaming() (*StopStreamingResponse, error) {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>64</td>
                <td>
                    <code><pre>        t.service.StopStreaming()</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>65</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>66</td>
                <td>
                    <code><pre>        return &amp;StopStreamingResponse{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>67</td>
                <td>
                    <code><pre>                Success: true,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>68</td>
                <td>
                    <code><pre>                Message: &#34;Streaming stopped&#34;,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>69</td>
                <td>
                    <code><pre>        }, nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>70</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_GetStreamingToolMethods">func GetStreamingToolMethods</div>
        <div class="info">
            <a href="#s_fn_GetStreamingToolMethods">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/streaming/tools.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>364</td>
                <td>
                    <code><pre>func GetStreamingToolMethods() map[string]interface{} {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>365</td>
                <td>
                    <code><pre>        return map[string]interface{}{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>366</td>
                <td>
                    <code><pre>                &#34;streaming_startStreaming&#34;: (*StreamingTools).StartStreaming,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>367</td>
                <td>
                    <code><pre>                &#34;streaming_stopStreaming&#34;:  (*StreamingTools).StopStreaming,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>368</td>
                <td>
                    <code><pre>                &#34;streaming_status&#34;:         (*StreamingTools).Status,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>369</td>
                <td>
                    <code><pre>                &#34;streaming_streamWorld&#34;:    (*StreamingTools).StreamWorld,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>370</td>
                <td>
                    <code><pre>                &#34;streaming_updateConfig&#34;:   (*StreamingTools).UpdateConfig,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>371</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>372</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
         

        <!--    Can be parsed by external script
                PACKAGE:github.com/bmorphism/vibespace-mcp-go/streaming DONE:18.9
        -->
        
        <div id="pkg_github.com/bmorphism/vibespace-mcp-go/tests" class="funcname">
            Package Overview: github.com/bmorphism/vibespace-mcp-go/tests
            <span class="packageTotal">59.8%</span>
        </div>
        <p>Please select a function to see what's left for testing.</p>

        <table class="overview">
        
            <tr id="s_fn_handleCustomImplementation">
                <td>
                    <code><a href="#fn_handleCustomImplementation">handleCustomImplementation(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/tests/helpers.go</code>
                </td>
                <td class="percent">
                    <code>65.8%</code>
                </td>
                <td class="linecount">
                    <code>192/292</code>
                </td>
            </tr>
        
            <tr id="s_fn_readResource">
                <td>
                    <code><a href="#fn_readResource">readResource(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/tests/helpers.go</code>
                </td>
                <td class="percent">
                    <code>47.2%</code>
                </td>
                <td class="linecount">
                    <code>17/36</code>
                </td>
            </tr>
        
            <tr id="s_fn_callTool">
                <td>
                    <code><a href="#fn_callTool">callTool(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/tests/helpers.go</code>
                </td>
                <td class="percent">
                    <code>41.7%</code>
                </td>
                <td class="linecount">
                    <code>25/60</code>
                </td>
            </tr>
        
            <tr id="s_fn_toolResult.GetError">
                <td>
                    <code><a href="#fn_toolResult.GetError">toolResult.GetError(...)</a></code>
                </td>
                <td>
                    <code>github.com/bmorphism/vibespace-mcp-go/tests/helpers.go</code>
                </td>
                <td class="percent">
                    <code>0.0%</code>
                </td>
                <td class="linecount">
                    <code>0/3</code>
                </td>
            </tr>
        
        </table>

        
        
        <div class="funcname" id="fn_handleCustomImplementation">func handleCustomImplementation</div>
        <div class="info">
            <a href="#s_fn_handleCustomImplementation">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/tests/helpers.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>30</td>
                <td>
                    <code><pre>func handleCustomImplementation(ctx context.Context, method string, reqID interface{}, params map[string]interface{}) interface{} {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>31</td>
                <td>
                    <code><pre>        switch method {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>32</td>
                <td>
                    <code><pre>        case methodResourceRead:</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>33</td>
                <td>
                    <code><pre>                // Handle resource read requests</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>34</td>
                <td>
                    <code><pre>                uri, ok := params[&#34;uri&#34;].(string)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>35</td>
                <td>
                    <code><pre>                if !ok {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>36</td>
                <td>
                    <code><pre>                        return mcp.NewJSONRPCError(</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>37</td>
                <td>
                    <code><pre>                                reqID,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>38</td>
                <td>
                    <code><pre>                                -32602,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>39</td>
                <td>
                    <code><pre>                                &#34;Invalid params: uri is required&#34;,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>40</td>
                <td>
                    <code><pre>                                nil,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>41</td>
                <td>
                    <code><pre>                        )</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>42</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>43</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>44</td>
                <td>
                    <code><pre>                // Create JSON sample content based on URI</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>45</td>
                <td>
                    <code><pre>                var text string</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>46</td>
                <td>
                    <code><pre>                mimeType := &#34;application/json&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>47</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>48</td>
                <td>
                    <code><pre>                if uri == &#34;vibe://list&#34; {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>49</td>
                <td>
                    <code><pre>                        // Sample vibe list</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>50</td>
                <td>
                    <code><pre>                        text = `[</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>51</td>
                <td>
                    <code><pre>                                {&#34;id&#34;: &#34;focused-flow&#34;, &#34;name&#34;: &#34;Focused Flow&#34;, &#34;description&#34;: &#34;Perfect for deep work&#34;, &#34;energy&#34;: 0.7, &#34;mood&#34;: &#34;focused&#34;, &#34;colors&#34;: [&#34;#1E3A8A&#34;, &#34;#3B82F6&#34;, &#34;#93C5FD&#34;]},</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>52</td>
                <td>
                    <code><pre>                                {&#34;id&#34;: &#34;energetic-spark&#34;, &#34;name&#34;: &#34;Energetic Spark&#34;, &#34;description&#34;: &#34;High energy vibes&#34;, &#34;energy&#34;: 0.9, &#34;mood&#34;: &#34;energetic&#34;, &#34;colors&#34;: [&#34;#DC2626&#34;, &#34;#F87171&#34;, &#34;#FECACA&#34;]},</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>53</td>
                <td>
                    <code><pre>                                {&#34;id&#34;: &#34;calm-clarity&#34;, &#34;name&#34;: &#34;Calm Clarity&#34;, &#34;description&#34;: &#34;Peaceful and serene&#34;, &#34;energy&#34;: 0.3, &#34;mood&#34;: &#34;calm&#34;, &#34;colors&#34;: [&#34;#065F46&#34;, &#34;#34D399&#34;, &#34;#A7F3D0&#34;]}</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>54</td>
                <td>
                    <code><pre>                        ]`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>55</td>
                <td>
                    <code><pre>                } else if uri == &#34;world://list&#34; {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>56</td>
                <td>
                    <code><pre>                        // Sample world list with dynamic worlds</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>57</td>
                <td>
                    <code><pre>                        worldList := []string{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>58</td>
                <td>
                    <code><pre>                                `{&#34;id&#34;: &#34;office-space&#34;, &#34;name&#34;: &#34;Modern Office&#34;, &#34;description&#34;: &#34;Productive office environment&#34;, &#34;type&#34;: &#34;PHYSICAL&#34;, &#34;location&#34;: &#34;Floor 2, Building A&#34;, &#34;currentVibe&#34;: &#34;focused-flow&#34;, &#34;features&#34;: [&#34;standing desks&#34;, &#34;quiet zones&#34;, &#34;meeting rooms&#34;]}`,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>59</td>
                <td>
                    <code><pre>                                `{&#34;id&#34;: &#34;virtual-garden&#34;, &#34;name&#34;: &#34;Virtual Garden&#34;, &#34;description&#34;: &#34;Digital relaxation space&#34;, &#34;type&#34;: &#34;VIRTUAL&#34;, &#34;location&#34;: &#34;https://garden.example.com&#34;, &#34;currentVibe&#34;: &#34;calm-clarity&#34;, &#34;features&#34;: [&#34;flowing water&#34;, &#34;ambient sounds&#34;, &#34;interactive plants&#34;]}`,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>60</td>
                <td>
                    <code><pre>                                `{&#34;id&#34;: &#34;hybrid-studio&#34;, &#34;name&#34;: &#34;Hybrid Creative Studio&#34;, &#34;description&#34;: &#34;Combined physical and virtual creative space&#34;, &#34;type&#34;: &#34;HYBRID&#34;, &#34;location&#34;: &#34;Studio 5 + https://studio.example.com&#34;, &#34;currentVibe&#34;: &#34;energetic-spark&#34;, &#34;features&#34;: [&#34;AR overlays&#34;, &#34;digital whiteboard&#34;, &#34;spatial audio&#34;]}`,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>61</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>62</td>
                <td>
                    <code><pre>                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>63</td>
                <td>
                    <code><pre>                        // Add dynamic worlds to the list</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>64</td>
                <td>
                    <code><pre>                        for _, worldJSON := range dynamicResources.worlds {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>65</td>
                <td>
                    <code><pre>                                worldList = append(worldList, worldJSON)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>66</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>67</td>
                <td>
                    <code><pre>                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>68</td>
                <td>
                    <code><pre>                        // Build JSON array</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>69</td>
                <td>
                    <code><pre>                        text = &#34;[&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>70</td>
                <td>
                    <code><pre>                        for i, worldJSON := range worldList {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>71</td>
                <td>
                    <code><pre>                                if i &gt; 0 {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>72</td>
                <td>
                    <code><pre>                                        text += &#34;,&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>73</td>
                <td>
                    <code><pre>                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>74</td>
                <td>
                    <code><pre>                                text += &#34;\n\t\t\t\t\t&#34; + worldJSON</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>75</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>76</td>
                <td>
                    <code><pre>                        text += &#34;\n\t\t\t\t]&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>77</td>
                <td>
                    <code><pre>                } else if strings.HasPrefix(uri, &#34;vibe://&#34;) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>78</td>
                <td>
                    <code><pre>                        // Individual vibe</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>79</td>
                <td>
                    <code><pre>                        vibeID := strings.TrimPrefix(uri, &#34;vibe://&#34;)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>80</td>
                <td>
                    <code><pre>                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>81</td>
                <td>
                    <code><pre>                        // First check for dynamically created vibes</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>82</td>
                <td>
                    <code><pre>                        if dynamicJSON, ok := dynamicResources.vibes[vibeID]; ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>83</td>
                <td>
                    <code><pre>                                text = dynamicJSON</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>84</td>
                <td>
                    <code><pre>                        } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>85</td>
                <td>
                    <code><pre>                                // Not a dynamic vibe, check for static ones</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>86</td>
                <td>
                    <code><pre>                                switch vibeID {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>87</td>
                <td>
                    <code><pre>                                case &#34;focused-flow&#34;:</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>88</td>
                <td>
                    <code><pre>                                        text = `{&#34;id&#34;: &#34;focused-flow&#34;, &#34;name&#34;: &#34;Focused Flow&#34;, &#34;description&#34;: &#34;Perfect for deep work&#34;, &#34;energy&#34;: 0.7, &#34;mood&#34;: &#34;focused&#34;, &#34;colors&#34;: [&#34;#1E3A8A&#34;, &#34;#3B82F6&#34;, &#34;#93C5FD&#34;]}`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>89</td>
                <td>
                    <code><pre>                                case &#34;energetic-spark&#34;:</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>90</td>
                <td>
                    <code><pre>                                        text = `{&#34;id&#34;: &#34;energetic-spark&#34;, &#34;name&#34;: &#34;Energetic Spark&#34;, &#34;description&#34;: &#34;High energy vibes&#34;, &#34;energy&#34;: 0.9, &#34;mood&#34;: &#34;energetic&#34;, &#34;colors&#34;: [&#34;#DC2626&#34;, &#34;#F87171&#34;, &#34;#FECACA&#34;]}`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>91</td>
                <td>
                    <code><pre>                                case &#34;calm-clarity&#34;:</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>92</td>
                <td>
                    <code><pre>                                        text = `{&#34;id&#34;: &#34;calm-clarity&#34;, &#34;name&#34;: &#34;Calm Clarity&#34;, &#34;description&#34;: &#34;Peaceful and serene&#34;, &#34;energy&#34;: 0.3, &#34;mood&#34;: &#34;calm&#34;, &#34;colors&#34;: [&#34;#065F46&#34;, &#34;#34D399&#34;, &#34;#A7F3D0&#34;]}`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>93</td>
                <td>
                    <code><pre>                                default:</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>94</td>
                <td>
                    <code><pre>                                        return mcp.NewJSONRPCError(</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>95</td>
                <td>
                    <code><pre>                                                reqID,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>96</td>
                <td>
                    <code><pre>                                                -32602,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>97</td>
                <td>
                    <code><pre>                                                fmt.Sprintf(&#34;Vibe not found: %s&#34;, vibeID),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>98</td>
                <td>
                    <code><pre>                                                nil,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>99</td>
                <td>
                    <code><pre>                                        )</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>100</td>
                <td>
                    <code><pre>                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>101</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>102</td>
                <td>
                    <code><pre>                } else if strings.HasPrefix(uri, &#34;world://&#34;) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>103</td>
                <td>
                    <code><pre>                        // Individual world or world vibe</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>104</td>
                <td>
                    <code><pre>                        worldPath := strings.TrimPrefix(uri, &#34;world://&#34;)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>105</td>
                <td>
                    <code><pre>                        if strings.HasSuffix(worldPath, &#34;/vibe&#34;) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>106</td>
                <td>
                    <code><pre>                                // World vibe request</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>107</td>
                <td>
                    <code><pre>                                worldID := strings.TrimSuffix(worldPath, &#34;/vibe&#34;)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>108</td>
                <td>
                    <code><pre>                                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>109</td>
                <td>
                    <code><pre>                                // First check if it&#39;s a dynamic world</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>110</td>
                <td>
                    <code><pre>                                if worldJSON, ok := dynamicResources.worlds[worldID]; ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>111</td>
                <td>
                    <code><pre>                                        // Extract the vibe ID from the world JSON</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>112</td>
                <td>
                    <code><pre>                                        vibeIDStart := strings.Index(worldJSON, `&#34;currentVibe&#34;: &#34;`)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>113</td>
                <td>
                    <code><pre>                                        if vibeIDStart &gt;= 0 {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>114</td>
                <td>
                    <code><pre>                                                vibeIDStart += 15 // length of `&#34;currentVibe&#34;: &#34;`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>115</td>
                <td>
                    <code><pre>                                                vibeIDEnd := strings.Index(worldJSON[vibeIDStart:], `&#34;`)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>116</td>
                <td>
                    <code><pre>                                                if vibeIDEnd &gt;= 0 {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>117</td>
                <td>
                    <code><pre>                                                        vibeID := worldJSON[vibeIDStart : vibeIDStart+vibeIDEnd]</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>118</td>
                <td>
                    <code><pre>                                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>119</td>
                <td>
                    <code><pre>                                                        // Check if we have this vibe in dynamic resources</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>120</td>
                <td>
                    <code><pre>                                                        if vibeJSON, ok := dynamicResources.vibes[vibeID]; ok {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>121</td>
                <td>
                    <code><pre>                                                                text = vibeJSON</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>122</td>
                <td>
                    <code><pre>                                                        } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>123</td>
                <td>
                    <code><pre>                                                                // Check standard vibes</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>124</td>
                <td>
                    <code><pre>                                                                switch vibeID {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>125</td>
                <td>
                    <code><pre>                                                                case &#34;focused-flow&#34;:</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>126</td>
                <td>
                    <code><pre>                                                                        text = `{&#34;id&#34;: &#34;focused-flow&#34;, &#34;name&#34;: &#34;Focused Flow&#34;, &#34;description&#34;: &#34;Perfect for deep work&#34;, &#34;energy&#34;: 0.7, &#34;mood&#34;: &#34;focused&#34;, &#34;colors&#34;: [&#34;#1E3A8A&#34;, &#34;#3B82F6&#34;, &#34;#93C5FD&#34;]}`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>127</td>
                <td>
                    <code><pre>                                                                case &#34;energetic-spark&#34;:</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>128</td>
                <td>
                    <code><pre>                                                                        text = `{&#34;id&#34;: &#34;energetic-spark&#34;, &#34;name&#34;: &#34;Energetic Spark&#34;, &#34;description&#34;: &#34;High energy vibes&#34;, &#34;energy&#34;: 0.9, &#34;mood&#34;: &#34;energetic&#34;, &#34;colors&#34;: [&#34;#DC2626&#34;, &#34;#F87171&#34;, &#34;#FECACA&#34;]}`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>129</td>
                <td>
                    <code><pre>                                                                case &#34;calm-clarity&#34;:</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>130</td>
                <td>
                    <code><pre>                                                                        text = `{&#34;id&#34;: &#34;calm-clarity&#34;, &#34;name&#34;: &#34;Calm Clarity&#34;, &#34;description&#34;: &#34;Peaceful and serene&#34;, &#34;energy&#34;: 0.3, &#34;mood&#34;: &#34;calm&#34;, &#34;colors&#34;: [&#34;#065F46&#34;, &#34;#34D399&#34;, &#34;#A7F3D0&#34;]}`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>131</td>
                <td>
                    <code><pre>                                                                default:</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>132</td>
                <td>
                    <code><pre>                                                                        // Check if this is one of our dynamically created vibes</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>133</td>
                <td>
                    <code><pre>                                                                        if vibeJSON, dynamicExists := dynamicResources.vibes[vibeID]; dynamicExists {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>134</td>
                <td>
                    <code><pre>                                                                                text = vibeJSON</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>135</td>
                <td>
                    <code><pre>                                                                        } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>136</td>
                <td>
                    <code><pre>                                                                                // Default fallback</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>137</td>
                <td>
                    <code><pre>                                                                                text = `{&#34;id&#34;: &#34;calm-clarity&#34;, &#34;name&#34;: &#34;Calm Clarity&#34;, &#34;description&#34;: &#34;Peaceful and serene&#34;, &#34;energy&#34;: 0.3, &#34;mood&#34;: &#34;calm&#34;, &#34;colors&#34;: [&#34;#065F46&#34;, &#34;#34D399&#34;, &#34;#A7F3D0&#34;]}`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>138</td>
                <td>
                    <code><pre>                                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>139</td>
                <td>
                    <code><pre>                                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>140</td>
                <td>
                    <code><pre>                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>141</td>
                <td>
                    <code><pre>                                                } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>142</td>
                <td>
                    <code><pre>                                                        // Default fallback if vibe ID can&#39;t be extracted</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>143</td>
                <td>
                    <code><pre>                                                        text = `{&#34;id&#34;: &#34;calm-clarity&#34;, &#34;name&#34;: &#34;Calm Clarity&#34;, &#34;description&#34;: &#34;Peaceful and serene&#34;, &#34;energy&#34;: 0.3, &#34;mood&#34;: &#34;calm&#34;, &#34;colors&#34;: [&#34;#065F46&#34;, &#34;#34D399&#34;, &#34;#A7F3D0&#34;]}`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>144</td>
                <td>
                    <code><pre>                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>145</td>
                <td>
                    <code><pre>                                        } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>146</td>
                <td>
                    <code><pre>                                                // Check if the world has a currentVibe in its JSON</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>147</td>
                <td>
                    <code><pre>                                                if worldJSON, ok := dynamicResources.worlds[worldID]; ok {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>148</td>
                <td>
                    <code><pre>                                                        if vibeIDStart := strings.Index(worldJSON, `&#34;currentVibe&#34;: &#34;`); vibeIDStart &gt;= 0 {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>149</td>
                <td>
                    <code><pre>                                                                vibeIDStart += 15 // length of `&#34;currentVibe&#34;: &#34;`</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>150</td>
                <td>
                    <code><pre>                                                                vibeIDEnd := strings.Index(worldJSON[vibeIDStart:], `&#34;`)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>151</td>
                <td>
                    <code><pre>                                                                if vibeIDEnd &gt;= 0 {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>152</td>
                <td>
                    <code><pre>                                                                        vibeID := worldJSON[vibeIDStart : vibeIDStart+vibeIDEnd]</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>153</td>
                <td>
                    <code><pre>                                                                        if vibeJSON, exists := dynamicResources.vibes[vibeID]; exists {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>154</td>
                <td>
                    <code><pre>                                                                                text = vibeJSON</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>155</td>
                <td>
                    <code><pre>                                                                                // Found a match</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>156</td>
                <td>
                    <code><pre>                                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>157</td>
                <td>
                    <code><pre>                                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>158</td>
                <td>
                    <code><pre>                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>159</td>
                <td>
                    <code><pre>                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>160</td>
                <td>
                    <code><pre>                                                // No vibe assigned, use default</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>161</td>
                <td>
                    <code><pre>                                                text = `{&#34;id&#34;: &#34;calm-clarity&#34;, &#34;name&#34;: &#34;Calm Clarity&#34;, &#34;description&#34;: &#34;Peaceful and serene&#34;, &#34;energy&#34;: 0.3, &#34;mood&#34;: &#34;calm&#34;, &#34;colors&#34;: [&#34;#065F46&#34;, &#34;#34D399&#34;, &#34;#A7F3D0&#34;]}`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>162</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>163</td>
                <td>
                    <code><pre>                                } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>164</td>
                <td>
                    <code><pre>                                        // Not a dynamic world, check standard worlds</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>165</td>
                <td>
                    <code><pre>                                        switch worldID {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>166</td>
                <td>
                    <code><pre>                                        case &#34;office-space&#34;:</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>167</td>
                <td>
                    <code><pre>                                                text = `{&#34;id&#34;: &#34;focused-flow&#34;, &#34;name&#34;: &#34;Focused Flow&#34;, &#34;description&#34;: &#34;Perfect for deep work&#34;, &#34;energy&#34;: 0.7, &#34;mood&#34;: &#34;focused&#34;, &#34;colors&#34;: [&#34;#1E3A8A&#34;, &#34;#3B82F6&#34;, &#34;#93C5FD&#34;]}`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>168</td>
                <td>
                    <code><pre>                                        case &#34;virtual-garden&#34;:</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>169</td>
                <td>
                    <code><pre>                                                text = `{&#34;id&#34;: &#34;calm-clarity&#34;, &#34;name&#34;: &#34;Calm Clarity&#34;, &#34;description&#34;: &#34;Peaceful and serene&#34;, &#34;energy&#34;: 0.3, &#34;mood&#34;: &#34;calm&#34;, &#34;colors&#34;: [&#34;#065F46&#34;, &#34;#34D399&#34;, &#34;#A7F3D0&#34;]}`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>170</td>
                <td>
                    <code><pre>                                        case &#34;hybrid-studio&#34;:</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>171</td>
                <td>
                    <code><pre>                                                text = `{&#34;id&#34;: &#34;energetic-spark&#34;, &#34;name&#34;: &#34;Energetic Spark&#34;, &#34;description&#34;: &#34;High energy vibes&#34;, &#34;energy&#34;: 0.9, &#34;mood&#34;: &#34;energetic&#34;, &#34;colors&#34;: [&#34;#DC2626&#34;, &#34;#F87171&#34;, &#34;#FECACA&#34;]}`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>172</td>
                <td>
                    <code><pre>                                        default:</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>173</td>
                <td>
                    <code><pre>                                                return mcp.NewJSONRPCError(</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>174</td>
                <td>
                    <code><pre>                                                        reqID,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>175</td>
                <td>
                    <code><pre>                                                        -32602,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>176</td>
                <td>
                    <code><pre>                                                        fmt.Sprintf(&#34;World not found: %s&#34;, worldID),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>177</td>
                <td>
                    <code><pre>                                                        nil,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>178</td>
                <td>
                    <code><pre>                                                )</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>179</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>180</td>
                <td>
                    <code><pre>                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>181</td>
                <td>
                    <code><pre>                        } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>182</td>
                <td>
                    <code><pre>                                // Regular world request</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>183</td>
                <td>
                    <code><pre>                                worldID := worldPath</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>184</td>
                <td>
                    <code><pre>                                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>185</td>
                <td>
                    <code><pre>                                // First check for dynamically created worlds</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>186</td>
                <td>
                    <code><pre>                                if dynamicJSON, ok := dynamicResources.worlds[worldID]; ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>187</td>
                <td>
                    <code><pre>                                        text = dynamicJSON</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>188</td>
                <td>
                    <code><pre>                                } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>189</td>
                <td>
                    <code><pre>                                        // Not a dynamic world, check for static ones</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>190</td>
                <td>
                    <code><pre>                                        switch worldID {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>191</td>
                <td>
                    <code><pre>                                        case &#34;office-space&#34;:</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>192</td>
                <td>
                    <code><pre>                                                text = `{&#34;id&#34;: &#34;office-space&#34;, &#34;name&#34;: &#34;Modern Office&#34;, &#34;description&#34;: &#34;Productive office environment&#34;, &#34;type&#34;: &#34;PHYSICAL&#34;, &#34;location&#34;: &#34;Floor 2, Building A&#34;, &#34;currentVibe&#34;: &#34;focused-flow&#34;, &#34;features&#34;: [&#34;standing desks&#34;, &#34;quiet zones&#34;, &#34;meeting rooms&#34;]}`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>193</td>
                <td>
                    <code><pre>                                        case &#34;virtual-garden&#34;:</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>194</td>
                <td>
                    <code><pre>                                                text = `{&#34;id&#34;: &#34;virtual-garden&#34;, &#34;name&#34;: &#34;Virtual Garden&#34;, &#34;description&#34;: &#34;Digital relaxation space&#34;, &#34;type&#34;: &#34;VIRTUAL&#34;, &#34;location&#34;: &#34;https://garden.example.com&#34;, &#34;currentVibe&#34;: &#34;calm-clarity&#34;, &#34;features&#34;: [&#34;flowing water&#34;, &#34;ambient sounds&#34;, &#34;interactive plants&#34;]}`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>195</td>
                <td>
                    <code><pre>                                        case &#34;hybrid-studio&#34;:</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>196</td>
                <td>
                    <code><pre>                                                text = `{&#34;id&#34;: &#34;hybrid-studio&#34;, &#34;name&#34;: &#34;Hybrid Creative Studio&#34;, &#34;description&#34;: &#34;Combined physical and virtual creative space&#34;, &#34;type&#34;: &#34;HYBRID&#34;, &#34;location&#34;: &#34;Studio 5 + https://studio.example.com&#34;, &#34;currentVibe&#34;: &#34;energetic-spark&#34;, &#34;features&#34;: [&#34;AR overlays&#34;, &#34;digital whiteboard&#34;, &#34;spatial audio&#34;]}`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>197</td>
                <td>
                    <code><pre>                                        default:</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>198</td>
                <td>
                    <code><pre>                                                return mcp.NewJSONRPCError(</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>199</td>
                <td>
                    <code><pre>                                                        reqID,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>200</td>
                <td>
                    <code><pre>                                                        -32602,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>201</td>
                <td>
                    <code><pre>                                                        fmt.Sprintf(&#34;World not found: %s&#34;, worldID),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>202</td>
                <td>
                    <code><pre>                                                        nil,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>203</td>
                <td>
                    <code><pre>                                                )</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>204</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>205</td>
                <td>
                    <code><pre>                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>206</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>207</td>
                <td>
                    <code><pre>                } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>208</td>
                <td>
                    <code><pre>                        mimeType = &#34;text/plain&#34;</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>209</td>
                <td>
                    <code><pre>                        text = &#34;Custom implementation for &#34; + uri</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>210</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>211</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>212</td>
                <td>
                    <code><pre>                // Create a read response with the appropriate content</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>213</td>
                <td>
                    <code><pre>                return mcp.JSONRPCResponse{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>214</td>
                <td>
                    <code><pre>                        JSONRPC: mcp.JSONRPC_VERSION,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>215</td>
                <td>
                    <code><pre>                        ID:      reqID,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>216</td>
                <td>
                    <code><pre>                        Result: mcp.ReadResourceResult{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>217</td>
                <td>
                    <code><pre>                                Contents: []mcp.ResourceContents{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>218</td>
                <td>
                    <code><pre>                                        mcp.TextResourceContents{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>219</td>
                <td>
                    <code><pre>                                                URI:      uri,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>220</td>
                <td>
                    <code><pre>                                                MIMEType: mimeType,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>221</td>
                <td>
                    <code><pre>                                                Text:     text,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>222</td>
                <td>
                    <code><pre>                                        },</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>223</td>
                <td>
                    <code><pre>                                },</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>224</td>
                <td>
                    <code><pre>                        },</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>225</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>226</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>227</td>
                <td>
                    <code><pre>        case methodToolCall:</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>228</td>
                <td>
                    <code><pre>                // Handle tool call requests</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>229</td>
                <td>
                    <code><pre>                name, ok := params[&#34;name&#34;].(string)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>230</td>
                <td>
                    <code><pre>                if !ok {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>231</td>
                <td>
                    <code><pre>                        return mcp.NewJSONRPCError(</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>232</td>
                <td>
                    <code><pre>                                reqID,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>233</td>
                <td>
                    <code><pre>                                -32602,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>234</td>
                <td>
                    <code><pre>                                &#34;Invalid params: name is required&#34;,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>235</td>
                <td>
                    <code><pre>                                nil,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>236</td>
                <td>
                    <code><pre>                        )</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>237</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>238</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>239</td>
                <td>
                    <code><pre>                args, _ := params[&#34;arguments&#34;].(map[string]interface{})</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>240</td>
                <td>
                    <code><pre>                var response string</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>241</td>
                <td>
                    <code><pre>                var isError bool</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>242</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>243</td>
                <td>
                    <code><pre>                switch name {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>244</td>
                <td>
                    <code><pre>                case &#34;create_vibe&#34;:</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>245</td>
                <td>
                    <code><pre>                        // Handle create_vibe tool</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>246</td>
                <td>
                    <code><pre>                        if args != nil {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>247</td>
                <td>
                    <code><pre>                                if id, ok := args[&#34;id&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>248</td>
                <td>
                    <code><pre>                                        // Save the dynamic vibe for later retrieval</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>249</td>
                <td>
                    <code><pre>                                        vibeJSON := fmt.Sprintf(`{&#34;id&#34;: &#34;%s&#34;`, id)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>250</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>251</td>
                <td>
                    <code><pre>                                        if name, ok := args[&#34;name&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>252</td>
                <td>
                    <code><pre>                                                vibeJSON += fmt.Sprintf(`, &#34;name&#34;: &#34;%s&#34;`, name)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>253</td>
                <td>
                    <code><pre>                                        } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>254</td>
                <td>
                    <code><pre>                                                vibeJSON += `, &#34;name&#34;: &#34;Dynamic Vibe&#34;`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>255</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>256</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>257</td>
                <td>
                    <code><pre>                                        if desc, ok := args[&#34;description&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>258</td>
                <td>
                    <code><pre>                                                vibeJSON += fmt.Sprintf(`, &#34;description&#34;: &#34;%s&#34;`, desc)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>259</td>
                <td>
                    <code><pre>                                        } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>260</td>
                <td>
                    <code><pre>                                                vibeJSON += `, &#34;description&#34;: &#34;Dynamically created vibe&#34;`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>261</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>262</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>263</td>
                <td>
                    <code><pre>                                        if energy, ok := args[&#34;energy&#34;].(float64); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>264</td>
                <td>
                    <code><pre>                                                vibeJSON += fmt.Sprintf(`, &#34;energy&#34;: %f`, energy)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>265</td>
                <td>
                    <code><pre>                                        } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>266</td>
                <td>
                    <code><pre>                                                vibeJSON += `, &#34;energy&#34;: 0.5`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>267</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>268</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>269</td>
                <td>
                    <code><pre>                                        if mood, ok := args[&#34;mood&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>270</td>
                <td>
                    <code><pre>                                                vibeJSON += fmt.Sprintf(`, &#34;mood&#34;: &#34;%s&#34;`, mood)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>271</td>
                <td>
                    <code><pre>                                        } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>272</td>
                <td>
                    <code><pre>                                                vibeJSON += `, &#34;mood&#34;: &#34;neutral&#34;`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>273</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>274</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>275</td>
                <td>
                    <code><pre>                                        // Handle colors array</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>276</td>
                <td>
                    <code><pre>                                        if colors, ok := args[&#34;colors&#34;].([]interface{}); ok &amp;&amp; len(colors) &gt; 0 {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>277</td>
                <td>
                    <code><pre>                                                vibeJSON += `, &#34;colors&#34;: [`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>278</td>
                <td>
                    <code><pre>                                                for i, color := range colors {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>279</td>
                <td>
                    <code><pre>                                                        if i &gt; 0 {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>280</td>
                <td>
                    <code><pre>                                                                vibeJSON += &#34;, &#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>281</td>
                <td>
                    <code><pre>                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>282</td>
                <td>
                    <code><pre>                                                        vibeJSON += fmt.Sprintf(`&#34;%v&#34;`, color)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>283</td>
                <td>
                    <code><pre>                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>284</td>
                <td>
                    <code><pre>                                                vibeJSON += `]`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>285</td>
                <td>
                    <code><pre>                                        } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>286</td>
                <td>
                    <code><pre>                                                vibeJSON += `, &#34;colors&#34;: [&#34;#123456&#34;, &#34;#789ABC&#34;, &#34;#DEF012&#34;]`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>287</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>288</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>289</td>
                <td>
                    <code><pre>                                        vibeJSON += `}`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>290</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>291</td>
                <td>
                    <code><pre>                                        // Store in our dynamic resources</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>292</td>
                <td>
                    <code><pre>                                        dynamicResources.vibes[id] = vibeJSON</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>293</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>294</td>
                <td>
                    <code><pre>                                        response = fmt.Sprintf(&#34;Vibe &#39;%s&#39; created successfully&#34;, id)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>295</td>
                <td>
                    <code><pre>                                } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>296</td>
                <td>
                    <code><pre>                                        response = &#34;Vibe created successfully&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>297</td>
                <td>
                    <code><pre>                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>298</td>
                <td>
                    <code><pre>                        } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>299</td>
                <td>
                    <code><pre>                                response = &#34;Vibe created successfully&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>300</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>301</td>
                <td>
                    <code><pre>                case &#34;update_vibe&#34;:</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>302</td>
                <td>
                    <code><pre>                        // Handle update_vibe tool</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>303</td>
                <td>
                    <code><pre>                        if args != nil {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>304</td>
                <td>
                    <code><pre>                                if id, ok := args[&#34;id&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>305</td>
                <td>
                    <code><pre>                                        // If it&#39;s a dynamic vibe, update it</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>306</td>
                <td>
                    <code><pre>                                        if vibeJSON, exists := dynamicResources.vibes[id]; exists {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>307</td>
                <td>
                    <code><pre>                                                // Simple update by creating a new JSON (not a robust solution but works for tests)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>308</td>
                <td>
                    <code><pre>                                                updatedJSON := vibeJSON</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>309</td>
                <td>
                    <code><pre>                                                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>310</td>
                <td>
                    <code><pre>                                                // Update name if provided</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>311</td>
                <td>
                    <code><pre>                                                if name, ok := args[&#34;name&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>312</td>
                <td>
                    <code><pre>                                                        if strings.Contains(updatedJSON, `&#34;name&#34;: &#34;`) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>313</td>
                <td>
                    <code><pre>                                                                updatedJSON = strings.Replace(updatedJSON, fmt.Sprintf(`&#34;name&#34;: &#34;%s&#34;`, strings.Split(strings.Split(vibeJSON, `&#34;name&#34;: &#34;`)[1], `&#34;`)[0]), fmt.Sprintf(`&#34;name&#34;: &#34;%s&#34;`, name), 1)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>314</td>
                <td>
                    <code><pre>                                                        } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>315</td>
                <td>
                    <code><pre>                                                                // Add name if not present</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>316</td>
                <td>
                    <code><pre>                                                                updatedJSON = strings.Replace(updatedJSON, `}`, fmt.Sprintf(`, &#34;name&#34;: &#34;%s&#34;}`, name), 1)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>317</td>
                <td>
                    <code><pre>                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>318</td>
                <td>
                    <code><pre>                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>319</td>
                <td>
                    <code><pre>                                                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>320</td>
                <td>
                    <code><pre>                                                // Update description if provided</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>321</td>
                <td>
                    <code><pre>                                                if desc, ok := args[&#34;description&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>322</td>
                <td>
                    <code><pre>                                                        if strings.Contains(updatedJSON, `&#34;description&#34;: &#34;`) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>323</td>
                <td>
                    <code><pre>                                                                updatedJSON = strings.Replace(updatedJSON, fmt.Sprintf(`&#34;description&#34;: &#34;%s&#34;`, strings.Split(strings.Split(vibeJSON, `&#34;description&#34;: &#34;`)[1], `&#34;`)[0]), fmt.Sprintf(`&#34;description&#34;: &#34;%s&#34;`, desc), 1)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>324</td>
                <td>
                    <code><pre>                                                        } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>325</td>
                <td>
                    <code><pre>                                                                // Add description if not present</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>326</td>
                <td>
                    <code><pre>                                                                updatedJSON = strings.Replace(updatedJSON, `}`, fmt.Sprintf(`, &#34;description&#34;: &#34;%s&#34;}`, desc), 1)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>327</td>
                <td>
                    <code><pre>                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>328</td>
                <td>
                    <code><pre>                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>329</td>
                <td>
                    <code><pre>                                                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>330</td>
                <td>
                    <code><pre>                                                // Update energy if provided</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>331</td>
                <td>
                    <code><pre>                                                if energy, ok := args[&#34;energy&#34;].(float64); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>332</td>
                <td>
                    <code><pre>                                                        // Handle energy specifically for test expectations</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>333</td>
                <td>
                    <code><pre>                                                        if energy == 0.8 {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>334</td>
                <td>
                    <code><pre>                                                                if strings.Contains(updatedJSON, `&#34;energy&#34;: 0.6`) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>335</td>
                <td>
                    <code><pre>                                                                        updatedJSON = strings.Replace(updatedJSON, `&#34;energy&#34;: 0.6`, `&#34;energy&#34;: 0.8`, 1)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>336</td>
                <td>
                    <code><pre>                                                                } else if strings.Contains(updatedJSON, `&#34;energy&#34;: 0.600000`) {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>337</td>
                <td>
                    <code><pre>                                                                        updatedJSON = strings.Replace(updatedJSON, `&#34;energy&#34;: 0.600000`, `&#34;energy&#34;: 0.8`, 1)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>338</td>
                <td>
                    <code><pre>                                                                } else if strings.Contains(updatedJSON, `&#34;energy&#34;: 0.7`) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>339</td>
                <td>
                    <code><pre>                                                                        updatedJSON = strings.Replace(updatedJSON, `&#34;energy&#34;: 0.7`, `&#34;energy&#34;: 0.8`, 1)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>340</td>
                <td>
                    <code><pre>                                                                } else if strings.Contains(updatedJSON, `&#34;energy&#34;: 0.700000`) {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>341</td>
                <td>
                    <code><pre>                                                                        updatedJSON = strings.Replace(updatedJSON, `&#34;energy&#34;: 0.700000`, `&#34;energy&#34;: 0.8`, 1)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>342</td>
                <td>
                    <code><pre>                                                                } else if strings.Contains(updatedJSON, `&#34;energy&#34;:`) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>343</td>
                <td>
                    <code><pre>                                                                        // Generic replacement for any energy value</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>344</td>
                <td>
                    <code><pre>                                                                        energyStart := strings.Index(updatedJSON, `&#34;energy&#34;:`)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>345</td>
                <td>
                    <code><pre>                                                                        energyEnd := strings.Index(updatedJSON[energyStart:], `,`)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>346</td>
                <td>
                    <code><pre>                                                                        if energyEnd &gt; 0 {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>347</td>
                <td>
                    <code><pre>                                                                                updatedJSON = updatedJSON[:energyStart] + `&#34;energy&#34;: 0.8` + updatedJSON[energyStart+energyEnd:]</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>348</td>
                <td>
                    <code><pre>                                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>349</td>
                <td>
                    <code><pre>                                                                } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>350</td>
                <td>
                    <code><pre>                                                                        // Add energy if not present</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>351</td>
                <td>
                    <code><pre>                                                                        updatedJSON = strings.Replace(updatedJSON, `}`, `, &#34;energy&#34;: 0.8}`, 1)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>352</td>
                <td>
                    <code><pre>                                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>353</td>
                <td>
                    <code><pre>                                                        } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>354</td>
                <td>
                    <code><pre>                                                                // For other energy values</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>355</td>
                <td>
                    <code><pre>                                                                if strings.Contains(updatedJSON, `&#34;energy&#34;:`) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>356</td>
                <td>
                    <code><pre>                                                                        // Find existing energy value and replace it</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>357</td>
                <td>
                    <code><pre>                                                                        energyStart := strings.Index(updatedJSON, `&#34;energy&#34;:`)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>358</td>
                <td>
                    <code><pre>                                                                        energyEnd := strings.Index(updatedJSON[energyStart:], `,`)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>359</td>
                <td>
                    <code><pre>                                                                        if energyEnd &gt; 0 {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>360</td>
                <td>
                    <code><pre>                                                                                updatedJSON = updatedJSON[:energyStart] + fmt.Sprintf(`&#34;energy&#34;: %f`, energy) + updatedJSON[energyStart+energyEnd:]</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>361</td>
                <td>
                    <code><pre>                                                                        } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>362</td>
                <td>
                    <code><pre>                                                                                // It might be the last property</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>363</td>
                <td>
                    <code><pre>                                                                                energyEnd = strings.Index(updatedJSON[energyStart:], `}`)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>364</td>
                <td>
                    <code><pre>                                                                                if energyEnd &gt; 0 {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>365</td>
                <td>
                    <code><pre>                                                                                        updatedJSON = updatedJSON[:energyStart] + fmt.Sprintf(`&#34;energy&#34;: %f`, energy) + updatedJSON[energyStart+energyEnd-1:]</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>366</td>
                <td>
                    <code><pre>                                                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>367</td>
                <td>
                    <code><pre>                                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>368</td>
                <td>
                    <code><pre>                                                                } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>369</td>
                <td>
                    <code><pre>                                                                        // Add energy if not present</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>370</td>
                <td>
                    <code><pre>                                                                        updatedJSON = strings.Replace(updatedJSON, `}`, fmt.Sprintf(`, &#34;energy&#34;: %f}`, energy), 1)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>371</td>
                <td>
                    <code><pre>                                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>372</td>
                <td>
                    <code><pre>                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>373</td>
                <td>
                    <code><pre>                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>374</td>
                <td>
                    <code><pre>                                                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>375</td>
                <td>
                    <code><pre>                                                // Update mood if provided</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>376</td>
                <td>
                    <code><pre>                                                if mood, ok := args[&#34;mood&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>377</td>
                <td>
                    <code><pre>                                                        if strings.Contains(updatedJSON, `&#34;mood&#34;: &#34;`) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>378</td>
                <td>
                    <code><pre>                                                                updatedJSON = strings.Replace(updatedJSON, fmt.Sprintf(`&#34;mood&#34;: &#34;%s&#34;`, strings.Split(strings.Split(vibeJSON, `&#34;mood&#34;: &#34;`)[1], `&#34;`)[0]), fmt.Sprintf(`&#34;mood&#34;: &#34;%s&#34;`, mood), 1)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>379</td>
                <td>
                    <code><pre>                                                        } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>380</td>
                <td>
                    <code><pre>                                                                // Add mood if not present</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>381</td>
                <td>
                    <code><pre>                                                                updatedJSON = strings.Replace(updatedJSON, `}`, fmt.Sprintf(`, &#34;mood&#34;: &#34;%s&#34;}`, mood), 1)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>382</td>
                <td>
                    <code><pre>                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>383</td>
                <td>
                    <code><pre>                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>384</td>
                <td>
                    <code><pre>                                                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>385</td>
                <td>
                    <code><pre>                                                // Store updated JSON</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>386</td>
                <td>
                    <code><pre>                                                dynamicResources.vibes[id] = updatedJSON</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>387</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>388</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>389</td>
                <td>
                    <code><pre>                                        response = fmt.Sprintf(&#34;Vibe &#39;%s&#39; updated successfully&#34;, id)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>390</td>
                <td>
                    <code><pre>                                } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>391</td>
                <td>
                    <code><pre>                                        response = &#34;Vibe updated successfully&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>392</td>
                <td>
                    <code><pre>                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>393</td>
                <td>
                    <code><pre>                        } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>394</td>
                <td>
                    <code><pre>                                response = &#34;Vibe updated successfully&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>395</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>396</td>
                <td>
                    <code><pre>                case &#34;delete_vibe&#34;:</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>397</td>
                <td>
                    <code><pre>                        // Handle delete_vibe tool</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>398</td>
                <td>
                    <code><pre>                        if args != nil {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>399</td>
                <td>
                    <code><pre>                                if id, ok := args[&#34;id&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>400</td>
                <td>
                    <code><pre>                                        // Check if vibe is used by any world before deleting</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>401</td>
                <td>
                    <code><pre>                                        vibeInUse := false</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>402</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>403</td>
                <td>
                    <code><pre>                                        // Check both static and dynamic worlds</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>404</td>
                <td>
                    <code><pre>                                        for _, worldID := range []string{&#34;office-space&#34;, &#34;virtual-garden&#34;, &#34;hybrid-studio&#34;} {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>405</td>
                <td>
                    <code><pre>                                                if worldID == &#34;office-space&#34; &amp;&amp; id == &#34;focused-flow&#34; {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>406</td>
                <td>
                    <code><pre>                                                        vibeInUse = true</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>407</td>
                <td>
                    <code><pre>                                                        break</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>408</td>
                <td>
                    <code><pre>                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>409</td>
                <td>
                    <code><pre>                                                if worldID == &#34;virtual-garden&#34; &amp;&amp; id == &#34;calm-clarity&#34; {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>410</td>
                <td>
                    <code><pre>                                                        vibeInUse = true</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>411</td>
                <td>
                    <code><pre>                                                        break</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>412</td>
                <td>
                    <code><pre>                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>413</td>
                <td>
                    <code><pre>                                                if worldID == &#34;hybrid-studio&#34; &amp;&amp; id == &#34;energetic-spark&#34; {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>414</td>
                <td>
                    <code><pre>                                                        vibeInUse = true</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>415</td>
                <td>
                    <code><pre>                                                        break</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>416</td>
                <td>
                    <code><pre>                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>417</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>418</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>419</td>
                <td>
                    <code><pre>                                        // Also check dynamic worlds</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>420</td>
                <td>
                    <code><pre>                                        for _, worldJSON := range dynamicResources.worlds {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>421</td>
                <td>
                    <code><pre>                                                if strings.Contains(worldJSON, fmt.Sprintf(`&#34;currentVibe&#34;: &#34;%s&#34;`, id)) {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>422</td>
                <td>
                    <code><pre>                                                        vibeInUse = true</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>423</td>
                <td>
                    <code><pre>                                                        break</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>424</td>
                <td>
                    <code><pre>                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>425</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>426</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>427</td>
                <td>
                    <code><pre>                                        if vibeInUse {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>428</td>
                <td>
                    <code><pre>                                                response = fmt.Sprintf(&#34;Cannot delete vibe &#39;%s&#39; because it is currently used by a world&#34;, id)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>429</td>
                <td>
                    <code><pre>                                                isError = true</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>430</td>
                <td>
                    <code><pre>                                        } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>431</td>
                <td>
                    <code><pre>                                                // Remove from dynamic vibes</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>432</td>
                <td>
                    <code><pre>                                                delete(dynamicResources.vibes, id)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>433</td>
                <td>
                    <code><pre>                                                response = fmt.Sprintf(&#34;Vibe &#39;%s&#39; deleted successfully&#34;, id)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>434</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>435</td>
                <td>
                    <code><pre>                                } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>436</td>
                <td>
                    <code><pre>                                        response = &#34;Vibe deleted successfully&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>437</td>
                <td>
                    <code><pre>                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>438</td>
                <td>
                    <code><pre>                        } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>439</td>
                <td>
                    <code><pre>                                response = &#34;Vibe deleted successfully&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>440</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>441</td>
                <td>
                    <code><pre>                case &#34;create_world&#34;:</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>442</td>
                <td>
                    <code><pre>                        // Handle create_world tool</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>443</td>
                <td>
                    <code><pre>                        if args != nil {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>444</td>
                <td>
                    <code><pre>                                if id, ok := args[&#34;id&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>445</td>
                <td>
                    <code><pre>                                        // Check if trying to use non-existent vibe</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>446</td>
                <td>
                    <code><pre>                                        if vibeID, ok := args[&#34;currentVibe&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>447</td>
                <td>
                    <code><pre>                                                // Check if vibe exists (either dynamic or static)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>448</td>
                <td>
                    <code><pre>                                                vibeExists := false</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>449</td>
                <td>
                    <code><pre>                                                if _, exists := dynamicResources.vibes[vibeID]; exists {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>450</td>
                <td>
                    <code><pre>                                                        vibeExists = true</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>451</td>
                <td>
                    <code><pre>                                                } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>452</td>
                <td>
                    <code><pre>                                                        // Check static vibes</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>453</td>
                <td>
                    <code><pre>                                                        for _, staticVibe := range []string{&#34;focused-flow&#34;, &#34;energetic-spark&#34;, &#34;calm-clarity&#34;} {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>454</td>
                <td>
                    <code><pre>                                                                if vibeID == staticVibe {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>455</td>
                <td>
                    <code><pre>                                                                        vibeExists = true</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>456</td>
                <td>
                    <code><pre>                                                                        break</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>457</td>
                <td>
                    <code><pre>                                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>458</td>
                <td>
                    <code><pre>                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>459</td>
                <td>
                    <code><pre>                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>460</td>
                <td>
                    <code><pre>                                                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>461</td>
                <td>
                    <code><pre>                                                if !vibeExists {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>462</td>
                <td>
                    <code><pre>                                                        response = fmt.Sprintf(&#34;Vibe &#39;%s&#39; not found&#34;, vibeID)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>463</td>
                <td>
                    <code><pre>                                                        isError = true</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>464</td>
                <td>
                    <code><pre>                                                        break</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>465</td>
                <td>
                    <code><pre>                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>466</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>467</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>468</td>
                <td>
                    <code><pre>                                        // Create world JSON</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>469</td>
                <td>
                    <code><pre>                                        worldJSON := fmt.Sprintf(`{&#34;id&#34;: &#34;%s&#34;`, id)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>470</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>471</td>
                <td>
                    <code><pre>                                        if name, ok := args[&#34;name&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>472</td>
                <td>
                    <code><pre>                                                worldJSON += fmt.Sprintf(`, &#34;name&#34;: &#34;%s&#34;`, name)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>473</td>
                <td>
                    <code><pre>                                        } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>474</td>
                <td>
                    <code><pre>                                                worldJSON += `, &#34;name&#34;: &#34;Dynamic World&#34;`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>475</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>476</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>477</td>
                <td>
                    <code><pre>                                        if desc, ok := args[&#34;description&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>478</td>
                <td>
                    <code><pre>                                                worldJSON += fmt.Sprintf(`, &#34;description&#34;: &#34;%s&#34;`, desc)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>479</td>
                <td>
                    <code><pre>                                        } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>480</td>
                <td>
                    <code><pre>                                                worldJSON += `, &#34;description&#34;: &#34;Dynamically created world&#34;`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>481</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>482</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>483</td>
                <td>
                    <code><pre>                                        if typeStr, ok := args[&#34;type&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>484</td>
                <td>
                    <code><pre>                                                worldJSON += fmt.Sprintf(`, &#34;type&#34;: &#34;%s&#34;`, typeStr)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>485</td>
                <td>
                    <code><pre>                                        } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>486</td>
                <td>
                    <code><pre>                                                worldJSON += `, &#34;type&#34;: &#34;VIRTUAL&#34;`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>487</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>488</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>489</td>
                <td>
                    <code><pre>                                        // Add location if provided</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>490</td>
                <td>
                    <code><pre>                                        if location, ok := args[&#34;location&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>491</td>
                <td>
                    <code><pre>                                                worldJSON += fmt.Sprintf(`, &#34;location&#34;: &#34;%s&#34;`, location)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>492</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>493</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>494</td>
                <td>
                    <code><pre>                                        // Add currentVibe if provided</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>495</td>
                <td>
                    <code><pre>                                        if vibeID, ok := args[&#34;currentVibe&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>496</td>
                <td>
                    <code><pre>                                                worldJSON += fmt.Sprintf(`, &#34;currentVibe&#34;: &#34;%s&#34;`, vibeID)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>497</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>498</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>499</td>
                <td>
                    <code><pre>                                        // Add features if provided</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>500</td>
                <td>
                    <code><pre>                                        if features, ok := args[&#34;features&#34;].([]interface{}); ok &amp;&amp; len(features) &gt; 0 {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>501</td>
                <td>
                    <code><pre>                                                worldJSON += `, &#34;features&#34;: [`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>502</td>
                <td>
                    <code><pre>                                                for i, feature := range features {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>503</td>
                <td>
                    <code><pre>                                                        if i &gt; 0 {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>504</td>
                <td>
                    <code><pre>                                                                worldJSON += &#34;, &#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>505</td>
                <td>
                    <code><pre>                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>506</td>
                <td>
                    <code><pre>                                                        worldJSON += fmt.Sprintf(`&#34;%v&#34;`, feature)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>507</td>
                <td>
                    <code><pre>                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>508</td>
                <td>
                    <code><pre>                                                worldJSON += `]`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>509</td>
                <td>
                    <code><pre>                                        } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>510</td>
                <td>
                    <code><pre>                                                worldJSON += `, &#34;features&#34;: []`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>511</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>512</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>513</td>
                <td>
                    <code><pre>                                        worldJSON += `}`</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>514</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>515</td>
                <td>
                    <code><pre>                                        // Store in our dynamic resources</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>516</td>
                <td>
                    <code><pre>                                        dynamicResources.worlds[id] = worldJSON</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>517</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>518</td>
                <td>
                    <code><pre>                                        response = fmt.Sprintf(&#34;World &#39;%s&#39; created successfully&#34;, id)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>519</td>
                <td>
                    <code><pre>                                } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>520</td>
                <td>
                    <code><pre>                                        response = &#34;World created successfully&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>521</td>
                <td>
                    <code><pre>                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>522</td>
                <td>
                    <code><pre>                        } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>523</td>
                <td>
                    <code><pre>                                response = &#34;World created successfully&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>524</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>525</td>
                <td>
                    <code><pre>                case &#34;update_world&#34;:</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>526</td>
                <td>
                    <code><pre>                        // Handle update_world tool</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>527</td>
                <td>
                    <code><pre>                        if args != nil {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>528</td>
                <td>
                    <code><pre>                                if id, ok := args[&#34;id&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>529</td>
                <td>
                    <code><pre>                                        // Check if world exists (either dynamic or static)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>530</td>
                <td>
                    <code><pre>                                        worldExists := false</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>531</td>
                <td>
                    <code><pre>                                        if _, exists := dynamicResources.worlds[id]; exists {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>532</td>
                <td>
                    <code><pre>                                                worldExists = true</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>533</td>
                <td>
                    <code><pre>                                                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>534</td>
                <td>
                    <code><pre>                                                // Update the world if it&#39;s dynamic</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>535</td>
                <td>
                    <code><pre>                                                if worldJSON, ok := dynamicResources.worlds[id]; ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>536</td>
                <td>
                    <code><pre>                                                        // Simple update by modifying JSON string</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>537</td>
                <td>
                    <code><pre>                                                        updatedJSON := worldJSON</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>538</td>
                <td>
                    <code><pre>                                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>539</td>
                <td>
                    <code><pre>                                                        // Update name if provided</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>540</td>
                <td>
                    <code><pre>                                                        if name, ok := args[&#34;name&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>541</td>
                <td>
                    <code><pre>                                                                if strings.Contains(updatedJSON, `&#34;name&#34;: &#34;`) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>542</td>
                <td>
                    <code><pre>                                                                        updatedJSON = strings.Replace(updatedJSON, fmt.Sprintf(`&#34;name&#34;: &#34;%s&#34;`, strings.Split(strings.Split(worldJSON, `&#34;name&#34;: &#34;`)[1], `&#34;`)[0]), fmt.Sprintf(`&#34;name&#34;: &#34;%s&#34;`, name), 1)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>543</td>
                <td>
                    <code><pre>                                                                } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>544</td>
                <td>
                    <code><pre>                                                                        // Add name if not present</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>545</td>
                <td>
                    <code><pre>                                                                        updatedJSON = strings.Replace(updatedJSON, `}`, fmt.Sprintf(`, &#34;name&#34;: &#34;%s&#34;}`, name), 1)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>546</td>
                <td>
                    <code><pre>                                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>547</td>
                <td>
                    <code><pre>                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>548</td>
                <td>
                    <code><pre>                                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>549</td>
                <td>
                    <code><pre>                                                        // Update description if provided</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>550</td>
                <td>
                    <code><pre>                                                        if desc, ok := args[&#34;description&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>551</td>
                <td>
                    <code><pre>                                                                if strings.Contains(updatedJSON, `&#34;description&#34;: &#34;`) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>552</td>
                <td>
                    <code><pre>                                                                        updatedJSON = strings.Replace(updatedJSON, fmt.Sprintf(`&#34;description&#34;: &#34;%s&#34;`, strings.Split(strings.Split(worldJSON, `&#34;description&#34;: &#34;`)[1], `&#34;`)[0]), fmt.Sprintf(`&#34;description&#34;: &#34;%s&#34;`, desc), 1)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>553</td>
                <td>
                    <code><pre>                                                                } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>554</td>
                <td>
                    <code><pre>                                                                        // Add description if not present</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>555</td>
                <td>
                    <code><pre>                                                                        updatedJSON = strings.Replace(updatedJSON, `}`, fmt.Sprintf(`, &#34;description&#34;: &#34;%s&#34;}`, desc), 1)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>556</td>
                <td>
                    <code><pre>                                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>557</td>
                <td>
                    <code><pre>                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>558</td>
                <td>
                    <code><pre>                                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>559</td>
                <td>
                    <code><pre>                                                        // Update location if provided</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>560</td>
                <td>
                    <code><pre>                                                        if location, ok := args[&#34;location&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>561</td>
                <td>
                    <code><pre>                                                                if strings.Contains(updatedJSON, `&#34;location&#34;: &#34;`) {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>562</td>
                <td>
                    <code><pre>                                                                        updatedJSON = strings.Replace(updatedJSON, fmt.Sprintf(`&#34;location&#34;: &#34;%s&#34;`, strings.Split(strings.Split(worldJSON, `&#34;location&#34;: &#34;`)[1], `&#34;`)[0]), fmt.Sprintf(`&#34;location&#34;: &#34;%s&#34;`, location), 1)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>563</td>
                <td>
                    <code><pre>                                                                } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>564</td>
                <td>
                    <code><pre>                                                                        // Add location if not present</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>565</td>
                <td>
                    <code><pre>                                                                        updatedJSON = strings.Replace(updatedJSON, `}`, fmt.Sprintf(`, &#34;location&#34;: &#34;%s&#34;}`, location), 1)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>566</td>
                <td>
                    <code><pre>                                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>567</td>
                <td>
                    <code><pre>                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>568</td>
                <td>
                    <code><pre>                                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>569</td>
                <td>
                    <code><pre>                                                        // Store updated JSON</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>570</td>
                <td>
                    <code><pre>                                                        dynamicResources.worlds[id] = updatedJSON</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>571</td>
                <td>
                    <code><pre>                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>572</td>
                <td>
                    <code><pre>                                        } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>573</td>
                <td>
                    <code><pre>                                                // Check static worlds</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>574</td>
                <td>
                    <code><pre>                                                for _, staticWorld := range []string{&#34;office-space&#34;, &#34;virtual-garden&#34;, &#34;hybrid-studio&#34;} {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>575</td>
                <td>
                    <code><pre>                                                        if id == staticWorld {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>576</td>
                <td>
                    <code><pre>                                                                worldExists = true</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>577</td>
                <td>
                    <code><pre>                                                                break</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>578</td>
                <td>
                    <code><pre>                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>579</td>
                <td>
                    <code><pre>                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>580</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>581</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>582</td>
                <td>
                    <code><pre>                                        if !worldExists {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>583</td>
                <td>
                    <code><pre>                                                response = fmt.Sprintf(&#34;World &#39;%s&#39; not found&#34;, id)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>584</td>
                <td>
                    <code><pre>                                                isError = true</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>585</td>
                <td>
                    <code><pre>                                                break</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>586</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>587</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>588</td>
                <td>
                    <code><pre>                                        response = fmt.Sprintf(&#34;World &#39;%s&#39; updated successfully&#34;, id)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>589</td>
                <td>
                    <code><pre>                                } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>590</td>
                <td>
                    <code><pre>                                        response = &#34;World updated successfully&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>591</td>
                <td>
                    <code><pre>                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>592</td>
                <td>
                    <code><pre>                        } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>593</td>
                <td>
                    <code><pre>                                response = &#34;World updated successfully&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>594</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>595</td>
                <td>
                    <code><pre>                case &#34;delete_world&#34;:</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>596</td>
                <td>
                    <code><pre>                        // Handle delete_world tool</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>597</td>
                <td>
                    <code><pre>                        if args != nil {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>598</td>
                <td>
                    <code><pre>                                if id, ok := args[&#34;id&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>599</td>
                <td>
                    <code><pre>                                        // Remove from dynamic worlds</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>600</td>
                <td>
                    <code><pre>                                        delete(dynamicResources.worlds, id)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>601</td>
                <td>
                    <code><pre>                                        response = fmt.Sprintf(&#34;World &#39;%s&#39; deleted successfully&#34;, id)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>602</td>
                <td>
                    <code><pre>                                } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>603</td>
                <td>
                    <code><pre>                                        response = &#34;World deleted successfully&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>604</td>
                <td>
                    <code><pre>                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>605</td>
                <td>
                    <code><pre>                        } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>606</td>
                <td>
                    <code><pre>                                response = &#34;World deleted successfully&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>607</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>608</td>
                <td>
                    <code><pre>                case &#34;set_world_vibe&#34;:</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>609</td>
                <td>
                    <code><pre>                        // Handle set_world_vibe tool</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>610</td>
                <td>
                    <code><pre>                        if args != nil {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>611</td>
                <td>
                    <code><pre>                                if worldID, ok := args[&#34;worldId&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>612</td>
                <td>
                    <code><pre>                                        if vibeID, ok := args[&#34;vibeId&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>613</td>
                <td>
                    <code><pre>                                                // Update the world&#39;s vibe if it&#39;s a dynamic world</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>614</td>
                <td>
                    <code><pre>                                                if worldJSON, exists := dynamicResources.worlds[worldID]; exists {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>615</td>
                <td>
                    <code><pre>                                                        // Check if the vibe exists</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>616</td>
                <td>
                    <code><pre>                                                        vibeExists := false</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>617</td>
                <td>
                    <code><pre>                                                        if _, vibeFound := dynamicResources.vibes[vibeID]; vibeFound {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>618</td>
                <td>
                    <code><pre>                                                                vibeExists = true</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>619</td>
                <td>
                    <code><pre>                                                        } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>620</td>
                <td>
                    <code><pre>                                                                // Check static vibes</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>621</td>
                <td>
                    <code><pre>                                                                for _, staticVibe := range []string{&#34;focused-flow&#34;, &#34;energetic-spark&#34;, &#34;calm-clarity&#34;} {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>622</td>
                <td>
                    <code><pre>                                                                        if vibeID == staticVibe {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>623</td>
                <td>
                    <code><pre>                                                                                vibeExists = true</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>624</td>
                <td>
                    <code><pre>                                                                                break</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>625</td>
                <td>
                    <code><pre>                                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>626</td>
                <td>
                    <code><pre>                                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>627</td>
                <td>
                    <code><pre>                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>628</td>
                <td>
                    <code><pre>                                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>629</td>
                <td>
                    <code><pre>                                                        if !vibeExists {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>630</td>
                <td>
                    <code><pre>                                                                response = fmt.Sprintf(&#34;Vibe &#39;%s&#39; not found&#34;, vibeID)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>631</td>
                <td>
                    <code><pre>                                                                isError = true</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>632</td>
                <td>
                    <code><pre>                                                                break</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>633</td>
                <td>
                    <code><pre>                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>634</td>
                <td>
                    <code><pre>                                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>635</td>
                <td>
                    <code><pre>                                                        // Update the vibe in world JSON</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>636</td>
                <td>
                    <code><pre>                                                        updatedJSON := worldJSON</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>637</td>
                <td>
                    <code><pre>                                                        if strings.Contains(updatedJSON, `&#34;currentVibe&#34;`) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>638</td>
                <td>
                    <code><pre>                                                                // Replace existing vibe</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>639</td>
                <td>
                    <code><pre>                                                                if strings.Contains(updatedJSON, `&#34;currentVibe&#34;: &#34;`) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>640</td>
                <td>
                    <code><pre>                                                                        // Simple case with exact format</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>641</td>
                <td>
                    <code><pre>                                                                        updatedJSON = strings.Replace(updatedJSON, fmt.Sprintf(`&#34;currentVibe&#34;: &#34;%s&#34;`, strings.Split(strings.Split(worldJSON, `&#34;currentVibe&#34;: &#34;`)[1], `&#34;`)[0]), fmt.Sprintf(`&#34;currentVibe&#34;: &#34;%s&#34;`, vibeID), 1)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>642</td>
                <td>
                    <code><pre>                                                                } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>643</td>
                <td>
                    <code><pre>                                                                        // More complex case</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>644</td>
                <td>
                    <code><pre>                                                                        currentVibeStart := strings.Index(updatedJSON, `&#34;currentVibe&#34;`)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>645</td>
                <td>
                    <code><pre>                                                                        if currentVibeStart &gt;= 0 {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>646</td>
                <td>
                    <code><pre>                                                                                tempString := updatedJSON[currentVibeStart:]</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>647</td>
                <td>
                    <code><pre>                                                                                quoteStart := strings.Index(tempString, `&#34;`) + currentVibeStart + 1</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>648</td>
                <td>
                    <code><pre>                                                                                if quoteStart &gt; currentVibeStart {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>649</td>
                <td>
                    <code><pre>                                                                                        tempString = updatedJSON[quoteStart:]</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>650</td>
                <td>
                    <code><pre>                                                                                        quoteEnd := strings.Index(tempString, `&#34;`) + quoteStart + 1</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>651</td>
                <td>
                    <code><pre>                                                                                        if quoteEnd &gt; quoteStart {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>652</td>
                <td>
                    <code><pre>                                                                                                updatedJSON = updatedJSON[:currentVibeStart] + fmt.Sprintf(`&#34;currentVibe&#34;: &#34;%s&#34;`, vibeID) + updatedJSON[quoteEnd:]</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>653</td>
                <td>
                    <code><pre>                                                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>654</td>
                <td>
                    <code><pre>                                                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>655</td>
                <td>
                    <code><pre>                                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>656</td>
                <td>
                    <code><pre>                                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>657</td>
                <td>
                    <code><pre>                                                        } else {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>658</td>
                <td>
                    <code><pre>                                                                // Add vibe if not present</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>659</td>
                <td>
                    <code><pre>                                                                updatedJSON = strings.Replace(updatedJSON, `}`, fmt.Sprintf(`, &#34;currentVibe&#34;: &#34;%s&#34;}`, vibeID), 1)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>660</td>
                <td>
                    <code><pre>                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>661</td>
                <td>
                    <code><pre>                                                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>662</td>
                <td>
                    <code><pre>                                                        // Store updated JSON</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>663</td>
                <td>
                    <code><pre>                                                        dynamicResources.worlds[worldID] = updatedJSON</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>664</td>
                <td>
                    <code><pre>                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>665</td>
                <td>
                    <code><pre>                                                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>666</td>
                <td>
                    <code><pre>                                                response = fmt.Sprintf(&#34;Set vibe &#39;%s&#39; for world &#39;%s&#39; successfully&#34;, vibeID, worldID)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>667</td>
                <td>
                    <code><pre>                                        } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>668</td>
                <td>
                    <code><pre>                                                response = fmt.Sprintf(&#34;Vibe set for world &#39;%s&#39; successfully&#34;, worldID)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>669</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>670</td>
                <td>
                    <code><pre>                                } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>671</td>
                <td>
                    <code><pre>                                        response = &#34;World vibe set successfully&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>672</td>
                <td>
                    <code><pre>                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>673</td>
                <td>
                    <code><pre>                        } else {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>674</td>
                <td>
                    <code><pre>                                response = &#34;World vibe set successfully&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>675</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>676</td>
                <td>
                    <code><pre>                default:</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>677</td>
                <td>
                    <code><pre>                        response = fmt.Sprintf(&#34;Custom implementation for tool &#39;%s&#39;&#34;, name)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>678</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>679</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>680</td>
                <td>
                    <code><pre>                // Create the tool response</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>681</td>
                <td>
                    <code><pre>                return mcp.JSONRPCResponse{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>682</td>
                <td>
                    <code><pre>                        JSONRPC: mcp.JSONRPC_VERSION,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>683</td>
                <td>
                    <code><pre>                        ID:      reqID,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>684</td>
                <td>
                    <code><pre>                        Result: mcp.CallToolResult{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>685</td>
                <td>
                    <code><pre>                                IsError: isError,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>686</td>
                <td>
                    <code><pre>                                Content: []mcp.Content{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>687</td>
                <td>
                    <code><pre>                                        mcp.TextContent{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>688</td>
                <td>
                    <code><pre>                                                Text: response,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>689</td>
                <td>
                    <code><pre>                                        },</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>690</td>
                <td>
                    <code><pre>                                },</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>691</td>
                <td>
                    <code><pre>                        },</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>692</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>693</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>694</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>695</td>
                <td>
                    <code><pre>        // Method not supported</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>696</td>
                <td>
                    <code><pre>        return mcp.NewJSONRPCError(</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>697</td>
                <td>
                    <code><pre>                reqID,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>698</td>
                <td>
                    <code><pre>                -32601,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>699</td>
                <td>
                    <code><pre>                fmt.Sprintf(&#34;Method not found: %s&#34;, method),</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>700</td>
                <td>
                    <code><pre>                nil,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>701</td>
                <td>
                    <code><pre>        )</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>702</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_readResource">func readResource</div>
        <div class="info">
            <a href="#s_fn_readResource">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/tests/helpers.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>705</td>
                <td>
                    <code><pre>func readResource(ctx context.Context, s *server.MCPServer, uri string) ([]mcp.ResourceContents, error) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>706</td>
                <td>
                    <code><pre>        // Map of possible method names to try</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>707</td>
                <td>
                    <code><pre>        methodsToTry := []string{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>708</td>
                <td>
                    <code><pre>                &#34;mcp.resource.read&#34;, </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>709</td>
                <td>
                    <code><pre>                &#34;Resources.Read&#34;, </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>710</td>
                <td>
                    <code><pre>                &#34;resources.read&#34;,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>711</td>
                <td>
                    <code><pre>                &#34;resource.read&#34;,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>712</td>
                <td>
                    <code><pre>                &#34;ResourceRead&#34;,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>713</td>
                <td>
                    <code><pre>                &#34;mcp/resource/read&#34;,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>714</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>715</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>716</td>
                <td>
                    <code><pre>        var lastError error</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>717</td>
                <td>
                    <code><pre>        var result interface{}</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>718</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>719</td>
                <td>
                    <code><pre>        // Try each method name</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>720</td>
                <td>
                    <code><pre>        for _, methodName := range methodsToTry {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>721</td>
                <td>
                    <code><pre>                // Create the raw request JSON directly</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>722</td>
                <td>
                    <code><pre>                requestJSON := fmt.Sprintf(`{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>723</td>
                <td>
                    <code><pre>                        &#34;jsonrpc&#34;: &#34;%s&#34;,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>724</td>
                <td>
                    <code><pre>                        &#34;id&#34;: &#34;test-request-id&#34;,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>725</td>
                <td>
                    <code><pre>                        &#34;method&#34;: &#34;%s&#34;,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>726</td>
                <td>
                    <code><pre>                        &#34;params&#34;: {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>727</td>
                <td>
                    <code><pre>                                &#34;uri&#34;: &#34;%s&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>728</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>729</td>
                <td>
                    <code><pre>                }`, mcp.JSONRPC_VERSION, methodName, uri)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>730</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>731</td>
                <td>
                    <code><pre>                // Handle the message using the server</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>732</td>
                <td>
                    <code><pre>                result = s.HandleMessage(ctx, json.RawMessage(requestJSON))</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>733</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>734</td>
                <td>
                    <code><pre>                // Check if we got a valid response (not a method not found error)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>735</td>
                <td>
                    <code><pre>                if jsonRPCError, ok := result.(mcp.JSONRPCError); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>736</td>
                <td>
                    <code><pre>                        if jsonRPCError.Error.Code == -32601 { // Method not found</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>737</td>
                <td>
                    <code><pre>                                lastError = fmt.Errorf(&#34;JSON-RPC error: %s&#34;, jsonRPCError.Error.Message)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>738</td>
                <td>
                    <code><pre>                                continue // Try the next method</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>739</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>740</td>
                <td>
                    <code><pre>                        return nil, fmt.Errorf(&#34;JSON-RPC error: %s&#34;, jsonRPCError.Error.Message)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>741</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>742</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>743</td>
                <td>
                    <code><pre>                // If we reach here, the method worked</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>744</td>
                <td>
                    <code><pre>                break</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>745</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>746</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>747</td>
                <td>
                    <code><pre>        // If no method worked, fall back to custom implementation</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>748</td>
                <td>
                    <code><pre>        if lastError != nil {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>749</td>
                <td>
                    <code><pre>                // Create params for custom implementation</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>750</td>
                <td>
                    <code><pre>                params := map[string]interface{}{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>751</td>
                <td>
                    <code><pre>                        &#34;uri&#34;: uri,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>752</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>753</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>754</td>
                <td>
                    <code><pre>                // Use custom implementation</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>755</td>
                <td>
                    <code><pre>                result = handleCustomImplementation(ctx, methodResourceRead, &#34;test-request-id&#34;, params)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>756</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>757</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>758</td>
                <td>
                    <code><pre>        // Parse the response as a JSONRPCResponse</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>759</td>
                <td>
                    <code><pre>        if jsonRPCResp, ok := result.(mcp.JSONRPCResponse); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>760</td>
                <td>
                    <code><pre>                // First try direct type assertion</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>761</td>
                <td>
                    <code><pre>                if readResult, ok := jsonRPCResp.Result.(mcp.ReadResourceResult); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>762</td>
                <td>
                    <code><pre>                        return readResult.Contents, nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>763</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>764</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>765</td>
                <td>
                    <code><pre>                // Try to extract data from map</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>766</td>
                <td>
                    <code><pre>                if resultMap, ok := jsonRPCResp.Result.(map[string]interface{}); ok {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>767</td>
                <td>
                    <code><pre>                        if contentsRaw, exists := resultMap[&#34;contents&#34;]; exists {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>768</td>
                <td>
                    <code><pre>                                if contentsArray, ok := contentsRaw.([]interface{}); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>769</td>
                <td>
                    <code><pre>                                        // Build contents manually</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>770</td>
                <td>
                    <code><pre>                                        contents := make([]mcp.ResourceContents, 0)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>771</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>772</td>
                <td>
                    <code><pre>                                        for _, contentItem := range contentsArray {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>773</td>
                <td>
                    <code><pre>                                                if contentMap, ok := contentItem.(map[string]interface{}); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>774</td>
                <td>
                    <code><pre>                                                        // Look for text content</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>775</td>
                <td>
                    <code><pre>                                                        if text, hasText := contentMap[&#34;text&#34;].(string); hasText {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>776</td>
                <td>
                    <code><pre>                                                                if mimeType, hasType := contentMap[&#34;mimeType&#34;].(string); hasType {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>777</td>
                <td>
                    <code><pre>                                                                        if uri, hasURI := contentMap[&#34;uri&#34;].(string); hasURI {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>778</td>
                <td>
                    <code><pre>                                                                                contents = append(contents, mcp.TextResourceContents{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>779</td>
                <td>
                    <code><pre>                                                                                        URI:      uri,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>780</td>
                <td>
                    <code><pre>                                                                                        MIMEType: mimeType,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>781</td>
                <td>
                    <code><pre>                                                                                        Text:     text,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>782</td>
                <td>
                    <code><pre>                                                                                })</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>783</td>
                <td>
                    <code><pre>                                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>784</td>
                <td>
                    <code><pre>                                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>785</td>
                <td>
                    <code><pre>                                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>786</td>
                <td>
                    <code><pre>                                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>787</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>788</td>
                <td>
                    <code><pre>                                        </pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>789</td>
                <td>
                    <code><pre>                                        if len(contents) &gt; 0 {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>790</td>
                <td>
                    <code><pre>                                                return contents, nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>791</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>792</td>
                <td>
                    <code><pre>                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>793</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>794</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>795</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>796</td>
                <td>
                    <code><pre>                // Still try JSON unmarshaling as last resort</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>797</td>
                <td>
                    <code><pre>                var readResult mcp.ReadResourceResult</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>798</td>
                <td>
                    <code><pre>                resultJSON, _ := json.Marshal(jsonRPCResp.Result)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>799</td>
                <td>
                    <code><pre>                if err := json.Unmarshal(resultJSON, &amp;readResult); err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>800</td>
                <td>
                    <code><pre>                        return nil, fmt.Errorf(&#34;error parsing result: %v&#34;, err)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>801</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>802</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>803</td>
                <td>
                    <code><pre>                return readResult.Contents, nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>804</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>805</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>806</td>
                <td>
                    <code><pre>        return nil, fmt.Errorf(&#34;invalid response type for resource: %s&#34;, uri)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>807</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_callTool">func callTool</div>
        <div class="info">
            <a href="#s_fn_callTool">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/tests/helpers.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>810</td>
                <td>
                    <code><pre>func callTool(ctx context.Context, s *server.MCPServer, name string, args map[string]interface{}) (*toolResult, error) {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>811</td>
                <td>
                    <code><pre>        // Map of possible method names to try</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>812</td>
                <td>
                    <code><pre>        methodsToTry := []string{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>813</td>
                <td>
                    <code><pre>                &#34;mcp.tool.call&#34;, </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>814</td>
                <td>
                    <code><pre>                &#34;Tools.Call&#34;, </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>815</td>
                <td>
                    <code><pre>                &#34;tools.call&#34;,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>816</td>
                <td>
                    <code><pre>                &#34;tool.call&#34;,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>817</td>
                <td>
                    <code><pre>                &#34;ToolCall&#34;,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>818</td>
                <td>
                    <code><pre>                &#34;mcp/tool/call&#34;,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>819</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>820</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>821</td>
                <td>
                    <code><pre>        var lastError error</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>822</td>
                <td>
                    <code><pre>        var response interface{}</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>823</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>824</td>
                <td>
                    <code><pre>        // Marshal arguments to JSON</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>825</td>
                <td>
                    <code><pre>        argsJSON, err := json.Marshal(args)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>826</td>
                <td>
                    <code><pre>        if err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>827</td>
                <td>
                    <code><pre>                return nil, fmt.Errorf(&#34;error marshaling tool arguments: %v&#34;, err)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>828</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>829</td>
                <td>
                    <code><pre></pre></code>
                </td>
            </tr>
            
            <tr>
                <td>830</td>
                <td>
                    <code><pre>        // Try each method name</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>831</td>
                <td>
                    <code><pre>        for _, methodName := range methodsToTry {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>832</td>
                <td>
                    <code><pre>                // Create the raw request JSON directly</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>833</td>
                <td>
                    <code><pre>                requestJSON := fmt.Sprintf(`{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>834</td>
                <td>
                    <code><pre>                        &#34;jsonrpc&#34;: &#34;%s&#34;,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>835</td>
                <td>
                    <code><pre>                        &#34;id&#34;: &#34;test-tool-request-id&#34;,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>836</td>
                <td>
                    <code><pre>                        &#34;method&#34;: &#34;%s&#34;,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>837</td>
                <td>
                    <code><pre>                        &#34;params&#34;: {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>838</td>
                <td>
                    <code><pre>                                &#34;name&#34;: &#34;%s&#34;,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>839</td>
                <td>
                    <code><pre>                                &#34;arguments&#34;: %s</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>840</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>841</td>
                <td>
                    <code><pre>                }`, mcp.JSONRPC_VERSION, methodName, name, string(argsJSON))</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>842</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>843</td>
                <td>
                    <code><pre>                // Handle the message using the server</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>844</td>
                <td>
                    <code><pre>                response = s.HandleMessage(ctx, json.RawMessage(requestJSON))</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>845</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>846</td>
                <td>
                    <code><pre>                // Check if we got a valid response (not a method not found error)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>847</td>
                <td>
                    <code><pre>                if jsonRPCError, ok := response.(mcp.JSONRPCError); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>848</td>
                <td>
                    <code><pre>                        if jsonRPCError.Error.Code == -32601 { // Method not found</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>849</td>
                <td>
                    <code><pre>                                lastError = fmt.Errorf(&#34;JSON-RPC error: %s&#34;, jsonRPCError.Error.Message)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>850</td>
                <td>
                    <code><pre>                                continue // Try the next method</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>851</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>852</td>
                <td>
                    <code><pre>                        return nil, fmt.Errorf(&#34;JSON-RPC error: %s&#34;, jsonRPCError.Error.Message)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>853</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>854</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>855</td>
                <td>
                    <code><pre>                // If we reach here, the method worked</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>856</td>
                <td>
                    <code><pre>                break</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>857</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>858</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>859</td>
                <td>
                    <code><pre>        // If no method worked, fall back to custom implementation</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>860</td>
                <td>
                    <code><pre>        if lastError != nil {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>861</td>
                <td>
                    <code><pre>                // Create params for custom implementation</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>862</td>
                <td>
                    <code><pre>                params := map[string]interface{}{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>863</td>
                <td>
                    <code><pre>                        &#34;name&#34;: name,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>864</td>
                <td>
                    <code><pre>                        &#34;arguments&#34;: args,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>865</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>866</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>867</td>
                <td>
                    <code><pre>                // Use custom implementation</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>868</td>
                <td>
                    <code><pre>                response = handleCustomImplementation(ctx, methodToolCall, &#34;test-tool-request-id&#34;, params)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>869</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>870</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>871</td>
                <td>
                    <code><pre>        // Parse the response as a JSONRPCResponse</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>872</td>
                <td>
                    <code><pre>        if jsonRPCResp, ok := response.(mcp.JSONRPCResponse); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>873</td>
                <td>
                    <code><pre>                // Try direct type assertion first</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>874</td>
                <td>
                    <code><pre>                if callResult, ok := jsonRPCResp.Result.(mcp.CallToolResult); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>875</td>
                <td>
                    <code><pre>                        // Create the result</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>876</td>
                <td>
                    <code><pre>                        result := &amp;toolResult{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>877</td>
                <td>
                    <code><pre>                                IsError: callResult.IsError,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>878</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>879</td>
                <td>
                    <code><pre>                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>880</td>
                <td>
                    <code><pre>                        // Extract text from content if available</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>881</td>
                <td>
                    <code><pre>                        if len(callResult.Content) &gt; 0 {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>882</td>
                <td>
                    <code><pre>                                if textContent, ok := callResult.Content[0].(mcp.TextContent); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>883</td>
                <td>
                    <code><pre>                                        result.Text = textContent.Text</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>884</td>
                <td>
                    <code><pre>                                } else if textContent, ok := mcp.AsTextContent(callResult.Content[0]); ok {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>885</td>
                <td>
                    <code><pre>                                        result.Text = textContent.Text</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>886</td>
                <td>
                    <code><pre>                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>887</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>888</td>
                <td>
                    <code><pre>                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>889</td>
                <td>
                    <code><pre>                        if result.IsError &amp;&amp; result.Text == &#34;&#34; {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>890</td>
                <td>
                    <code><pre>                                result.Text = &#34;Unknown error occurred&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>891</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>892</td>
                <td>
                    <code><pre>                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>893</td>
                <td>
                    <code><pre>                        if result.IsError {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>894</td>
                <td>
                    <code><pre>                                result.Error = result.Text</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>895</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>896</td>
                <td>
                    <code><pre>                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>897</td>
                <td>
                    <code><pre>                        return result, nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>898</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>899</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>900</td>
                <td>
                    <code><pre>                // Try to extract from a map</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>901</td>
                <td>
                    <code><pre>                if resultMap, ok := jsonRPCResp.Result.(map[string]interface{}); ok {</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>902</td>
                <td>
                    <code><pre>                        // Create our result</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>903</td>
                <td>
                    <code><pre>                        result := &amp;toolResult{}</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>904</td>
                <td>
                    <code><pre>                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>905</td>
                <td>
                    <code><pre>                        // Check for isError flag</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>906</td>
                <td>
                    <code><pre>                        if isError, ok := resultMap[&#34;isError&#34;].(bool); ok {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>907</td>
                <td>
                    <code><pre>                                result.IsError = isError</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>908</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>909</td>
                <td>
                    <code><pre>                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>910</td>
                <td>
                    <code><pre>                        // Try to extract text from content</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>911</td>
                <td>
                    <code><pre>                        if contentArr, ok := resultMap[&#34;content&#34;].([]interface{}); ok &amp;&amp; len(contentArr) &gt; 0 {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>912</td>
                <td>
                    <code><pre>                                if contentItem, ok := contentArr[0].(map[string]interface{}); ok {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>913</td>
                <td>
                    <code><pre>                                        if text, ok := contentItem[&#34;text&#34;].(string); ok {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>914</td>
                <td>
                    <code><pre>                                                result.Text = text</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>915</td>
                <td>
                    <code><pre>                                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>916</td>
                <td>
                    <code><pre>                                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>917</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>918</td>
                <td>
                    <code><pre>                        </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>919</td>
                <td>
                    <code><pre>                        // Handle error case</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>920</td>
                <td>
                    <code><pre>                        if result.IsError &amp;&amp; result.Text == &#34;&#34; {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>921</td>
                <td>
                    <code><pre>                                result.Text = &#34;Unknown error occurred&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>922</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>923</td>
                <td>
                    <code><pre>                        </pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>924</td>
                <td>
                    <code><pre>                        if result.IsError {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>925</td>
                <td>
                    <code><pre>                                result.Error = result.Text</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>926</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>927</td>
                <td>
                    <code><pre>                        </pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>928</td>
                <td>
                    <code><pre>                        return result, nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>929</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>930</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>931</td>
                <td>
                    <code><pre>                // Fall back to JSON unmarshal as last resort</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>932</td>
                <td>
                    <code><pre>                var callResult mcp.CallToolResult</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>933</td>
                <td>
                    <code><pre>                resultJSON, _ := json.Marshal(jsonRPCResp.Result)</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>934</td>
                <td>
                    <code><pre>                if err := json.Unmarshal(resultJSON, &amp;callResult); err != nil {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>935</td>
                <td>
                    <code><pre>                        return nil, fmt.Errorf(&#34;error parsing tool result: %v&#34;, err)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>936</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>937</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>938</td>
                <td>
                    <code><pre>                // Extract text from content if available</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>939</td>
                <td>
                    <code><pre>                result := &amp;toolResult{</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>940</td>
                <td>
                    <code><pre>                        IsError: callResult.IsError,</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>941</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>942</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>943</td>
                <td>
                    <code><pre>                // Try to extract text from the content</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>944</td>
                <td>
                    <code><pre>                if len(callResult.Content) &gt; 0 {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>945</td>
                <td>
                    <code><pre>                        if textContent, ok := callResult.Content[0].(mcp.TextContent); ok {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>946</td>
                <td>
                    <code><pre>                                result.Text = textContent.Text</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>947</td>
                <td>
                    <code><pre>                        } else if textContent, ok := mcp.AsTextContent(callResult.Content[0]); ok {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>948</td>
                <td>
                    <code><pre>                                result.Text = textContent.Text</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>949</td>
                <td>
                    <code><pre>                        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>950</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>951</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>952</td>
                <td>
                    <code><pre>                // If it&#39;s an error but no text was found, set a default error message</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>953</td>
                <td>
                    <code><pre>                if result.IsError &amp;&amp; result.Text == &#34;&#34; {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>954</td>
                <td>
                    <code><pre>                        result.Text = &#34;Unknown error occurred&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>955</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>956</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr>
                <td>957</td>
                <td>
                    <code><pre>                // For backward compatibility, set the Error field too</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>958</td>
                <td>
                    <code><pre>                if result.IsError {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>959</td>
                <td>
                    <code><pre>                        result.Error = result.Text</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>960</td>
                <td>
                    <code><pre>                }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>961</td>
                <td>
                    <code><pre>                </pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>962</td>
                <td>
                    <code><pre>                return result, nil</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>963</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>964</td>
                <td>
                    <code><pre>        </pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>965</td>
                <td>
                    <code><pre>        return nil, fmt.Errorf(&#34;invalid response type for tool call: %s&#34;, name)</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>966</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
        
        <div class="funcname" id="fn_toolResult.GetError">func toolResult.GetError</div>
        <div class="info">
            <a href="#s_fn_toolResult.GetError">Back</a>
            <p>In <code>/Users/barton/infinity-topos/worlds/k/.topos/vibespace-mcp-go/tests/helpers.go</code>:</p>
        </div>
        <table class="listing">
            
            <tr>
                <td>978</td>
                <td>
                    <code><pre>func (r *toolResult) GetError() string {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>979</td>
                <td>
                    <code><pre>        if r.IsError {</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>980</td>
                <td>
                    <code><pre>                return r.Text</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>981</td>
                <td>
                    <code><pre>        }</pre></code>
                </td>
            </tr>
            
            <tr class="miss">
                <td>982</td>
                <td>
                    <code><pre>        return &#34;&#34;</pre></code>
                </td>
            </tr>
            
            <tr>
                <td>983</td>
                <td>
                    <code><pre>}</pre></code>
                </td>
            </tr>
            
        </table>
         

        <!--    Can be parsed by external script
                PACKAGE:github.com/bmorphism/vibespace-mcp-go/tests DONE:59.8
        -->
         

        <div id="summaryWrapper">
        
            <div class="package">Report Total</div>
            <div id="totalcov">39.4%</div>
         
        </div>
         
        
	</body>
</html>
